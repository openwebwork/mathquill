(()=>{"use strict";
/* @license
 * MathQuill, by Han, Jeanine, and Mary
 * http://mathquill.com | maintainers@mathquill.com
 *
 * Rewritten for the purposes of WeBWorK.
 * https://github.com/openwebwork
 *
 * This Source Code Form is subject to the terms of the
 * Mozilla Public License, v. 2.0. If a copy of the MPL
 * was not distributed with this file, You can obtain
 * one at http://mozilla.org/MPL/2.0/.
 */
const t="data-mathquill-command-id",e="data-mathquill-block-id",s=-1,n=()=>{},i=t=>(e,s,n)=>t("function"==typeof e?e:t=>{if(e in t)return t[e](s,n)}),r=(t,...e)=>class extends t{constructor(...t){super(...e)}},o=(t,e=!1)=>{if(!e)throw new Error(`prayer failed: ${t}`)},l=t=>{o("a direction was passed",t===s||1===t)},a=(t,e,n)=>{o("a parent is always present",!!t),o("leftward is properly set up",e?e[1]===n&&e.parent===t:(null==t?void 0:t.ends[s])===n),o("rightward is properly set up",n?n[s]===e&&n.parent===t:(null==t?void 0:t.ends[1])===e)},c={},d={},h={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "},u={},p={};for(const t of["arg","det","dim","exp","gcd","hom","ker","lg","lim","ln","log","max","min","sup","limsup","liminf","injlim","projlim","Pr"])p[t]=1;for(const t of["sin","cos","tan","arcsin","arccos","arctan","sinh","cosh","tanh","sec","csc","cot","coth"])p[t]=1;const m={limsup:1,liminf:1,projlim:1,injlim:1},f=(()=>{const t={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return(e,s)=>{let i=null,r=null;const o=e,l=s.container||o;let a,c=n;const d=t=>{c=t,clearTimeout(a),a=setTimeout(t)},h=t=>{d((e=>{c=n,clearTimeout(a),t(e)}))};for(const t of["keydown","keypress","input","keyup","focusout","paste"])l.addEventListener(t,(t=>c(t)));let u=!1;const p=()=>{var e;return null===(e=s.keystroke)||void 0===e?void 0:e.call(s,(e=>{const s=e.which||e.keyCode,n=t[s],i=[];e.ctrlKey&&i.push("Ctrl"),e.metaKey&&i.push("Meta"),e.altKey&&i.push("Alt"),e.shiftKey&&i.push("Shift");const r=n||String.fromCharCode(s);return i.length||n?(i.push(r),i.join("-")):r})(i),i)},m=()=>{if((()=>{const t=o;return"selectionStart"in t&&t.selectionStart!==t.selectionEnd})())return;const t=o.value;1===t.length?(o.value="",s.typedText(t)):t&&o.select&&o.select()};return l.addEventListener("keydown",(t=>{t.target===o&&(i=t,r=null,u&&h((t=>{t&&"focusout"===t.type||!o.select||o.select()})),p())})),l.addEventListener("keypress",(t=>{t.target===o&&(i&&r&&p(),r=t,d(m))})),l.addEventListener("keyup",(t=>{t.target===o&&i&&!r&&h(m)})),l.addEventListener("focusout",(()=>{i=r=null})),l.addEventListener("cut",(()=>h((()=>s.cut())))),l.addEventListener("copy",(()=>h((()=>s.copy())))),l.addEventListener("paste",(t=>{var e,n;if(t.target!==o)return;o.focus();const i=null!==(n=null===(e=t.clipboardData)||void 0===e?void 0:e.getData("text"))&&void 0!==n?n:"";h((()=>{const t=o.value||i;o.value="",t&&s.paste(t)}))})),{select:t=>{c(),c=n,clearTimeout(a),o.value=t,t&&o.select&&o.select(),u=!!t}}}})();class v{constructor(){this.ignoreNextMousedown=()=>!1}static config(t,e){Object.assign(t,e)}get mouseEvents(){var t;return null!==(t=this._mouseEvents)&&void 0!==t?t:v.mouseEvents}set mouseEvents(t){this._mouseEvents=t}get autoCommands(){var t;return null!==(t=this._autoCommands)&&void 0!==t?t:v.autoCommands}set autoCommands(t){if("object"==typeof t)return void(this._autoCommands=t);if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw`"${t}" not a space-delimited list of only letters`;const e=t.split(" "),s={_maxLength:0};for(const t of e){if(t.length<2)throw`autocommand "${t}" not minimum length of 2`;if(t in p)throw`"${t}" is a built-in operator name`;s[t]=1,s._maxLength=Math.max(s._maxLength,t.length)}this._autoCommands=s}get autoOperatorNames(){var t;return null!==(t=this._autoOperatorNames)&&void 0!==t?t:v.autoOperatorNames}set autoOperatorNames(t){if("object"==typeof t)return void(this._autoCommands=t);if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw`"${t}" not a space-delimited list of only letters`;const e=t.split(" "),s={_maxLength:0};for(const t of e){if(t.length<2)throw`"${t}" not minimum length of 2`;s[t]=1,s._maxLength=Math.max(s._maxLength,t.length)}this._autoOperatorNames=s}get charsThatBreakOutOfSupSub(){var t;return null!==(t=this._charsThatBreakOutOfSupSub)&&void 0!==t?t:v.charsThatBreakOutOfSupSub}set charsThatBreakOutOfSupSub(t){this._charsThatBreakOutOfSupSub=t}get statelessClipboard(){var t;return null!==(t=this._statelessClipboard)&&void 0!==t?t:v.statelessClipboard}set statelessClipboard(t){this._statelessClipboard=t}get spaceBehavesLikeTab(){var t;return null!==(t=this._spaceBehavesLikeTab)&&void 0!==t?t:v.spaceBehavesLikeTab}set spaceBehavesLikeTab(t){this._spaceBehavesLikeTab=t}get leftRightIntoCmdGoes(){var t;return null!==(t=this._leftRightIntoCmdGoes)&&void 0!==t?t:v.leftRightIntoCmdGoes}set leftRightIntoCmdGoes(t){if(t&&"up"!==t&&"down"!==t)throw`"up" or "down" required for leftRightIntoCmdGoes option, got "${t}"`;this._leftRightIntoCmdGoes=t}get restrictMismatchedBrackets(){var t;return null!==(t=this._restrictMismatchedBrackes)&&void 0!==t?t:v.restrictMismatchedBrackets}set restrictMismatchedBrackets(t){this._restrictMismatchedBrackes=t}get sumStartsWithNEquals(){var t;return null!==(t=this._sumStartsWithNEquals)&&void 0!==t?t:v.sumStartsWithNEquals}set sumStartsWithNEquals(t){this._sumStartsWithNEquals=t}get supSubsRequireOperand(){var t;return null!==(t=this._supSubsRequireOperand)&&void 0!==t?t:v.supSubsRequireOperand}set supSubsRequireOperand(t){this._supSubsRequireOperand=t}get rootsAreExponents(){var t;return null!==(t=this._rootsAreExponents)&&void 0!==t?t:v.rootsAreExponents}set rootsAreExponents(t){this._rootsAreExponents=t}get maxDepth(){var t;return null!==(t=this._maxDepth)&&void 0!==t?t:v.maxDepth}set maxDepth(t){"number"==typeof t&&(this._maxDepth=t)}get autoSubscriptNumerals(){var t;return null!==(t=this._autoSubscriptNumerals)&&void 0!==t?t:v.autoSubscriptNumerals}set autoSubscriptNumerals(t){this._autoSubscriptNumerals=t}get typingSlashWritesDivisionSymbol(){var t;return null!==(t=this._typingSlashWritesDivisionSymbol)&&void 0!==t?t:v.typingSlashWritesDivisionSymbol}set typingSlashWritesDivisionSymbol(t){this._typingSlashWritesDivisionSymbol=t}get typingAsteriskWritesTimesSymbol(){var t;return null!==(t=this._typingAsteriskWritesTimesSymbol)&&void 0!==t?t:v.typingAsteriskWritesTimesSymbol}set typingAsteriskWritesTimesSymbol(t){this._typingAsteriskWritesTimesSymbol=t}substituteTextarea(){const t=document.createElement("textarea");return t.setAttribute("autocapitalize","off"),t.setAttribute("autocomplete","off"),t.setAttribute("autocorrext","off"),t.setAttribute("spellcheck","false"),t}substituteKeyboardEvents(t,e){return f(t,e)}}v.mouseEvents=!0,v.autoCommands={_maxLength:0},v.autoOperatorNames=(()=>{const t={_maxLength:9};for(const e of["arg","det","dim","exp","gcd","hom","ker","lg","lim","ln","log","max","min","sup","limsup","liminf","injlim","projlim","Pr"])t[e]=1;for(const e of["sin","cos","tan","sec","cosec","csc","cotan","cot","ctg"])t[e]=t[`arc${e}`]=t[`${e}h`]=t[`ar${e}h`]=t[`arc${e}h`]=1;for(const e of["gcf","hcf","lcm","proj","span"])t[e]=1;return t})(),v.charsThatBreakOutOfSupSub="",v.statelessClipboard=!1,v.spaceBehavesLikeTab=!1,v.leftRightIntoCmdGoes=void 0,v.restrictMismatchedBrackets=!1,v.sumStartsWithNEquals=!1,v.supSubsRequireOperand=!1,v.rootsAreExponents=!1,v.maxDepth=void 0,v.autoSubscriptNumerals=!1,v.typingSlashWritesDivisionSymbol=!1,v.typingAsteriskWritesTimesSymbol=!1;class g{constructor(t){if(this.contents=[],t instanceof g)this.contents.push(...t.contents);else if(t instanceof Node)this.contents.push(t);else if(t instanceof Array)this.contents.push(...t);else if(t){const e=document.createRange().createContextualFragment(t);this.contents.push(...e.children)}}add(t){this.contents.push(...t instanceof g?t.contents:t instanceof Array?t:[t]),this.contents.sort(((t,e)=>{if(t===e)return 0;const s=t.compareDocumentPosition(e);return s&Node.DOCUMENT_POSITION_FOLLOWING||s&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:s&Node.DOCUMENT_POSITION_PRECEDING||s&Node.DOCUMENT_POSITION_CONTAINS?1:0}))}get first(){return this.contents[0]instanceof Element||this.contents[0]instanceof CharacterData?this.contents[0]:document.createElement("span")}get last(){const t=this.contents[this.contents.length-1];return t instanceof Element||t instanceof CharacterData?t:document.createElement("span")}get firstElement(){return this.first instanceof HTMLElement?this.first:document.createElement("span")}get lastElement(){return this.last instanceof HTMLElement?this.last:document.createElement("span")}detach(){this.contents.forEach((t=>t.remove()))}remove(){this.detach(),this.contents=[]}empty(){this.contents.forEach((t=>{for(;t.firstChild;)t.firstChild.remove();t.textContent=""}))}children(t){return new g(this.contents.reduce(((e,s)=>(e.push(...Array.from(s.childNodes).filter((e=>3!==e.nodeType&&(!t||e instanceof Element&&e.matches(t))))),e)),[]))}find(t){return new g(this.contents.reduce(((e,s)=>(e.push(...s.querySelectorAll(t)),e)),[]))}addClass(...t){this.contents.forEach((e=>{e instanceof Element&&e.classList.add(...t)}))}removeClass(...t){this.contents.forEach((e=>{e instanceof Element&&e.classList.remove(...t)}))}toggleClass(t,e){this.contents.forEach((s=>{s instanceof Element&&s.classList.toggle(t,e)}))}hasClass(t){for(const e of this.contents)if(e instanceof Element&&e.classList.contains(t))return!0;return!1}html(t){var e,s;return"string"==typeof t?(this.contents.forEach((e=>{e instanceof Element&&(e.innerHTML=t)})),this):null!==(s=null===(e=this.firstElement)||void 0===e?void 0:e.innerHTML)&&void 0!==s?s:""}text(t){return t?(this.contents.forEach((e=>{e instanceof Element&&(e.textContent=t)})),this):this.contents.reduce(((t,e)=>{var s;return`${t}${null!==(s=e.textContent)&&void 0!==s?s:""}`}),"")}insDirOf(t,e){e instanceof g&&!e.contents.length||(t===s?(e instanceof g?e.first:e).before(...this.contents):(e instanceof g?e.last:e).after(...this.contents))}insAtDirEnd(t,e){e instanceof g&&!e.contents.length||(t===s?(e instanceof g?e.firstElement:e).prepend(...this.contents):(e instanceof g?e.lastElement:e).append(...this.contents))}}class b{constructor(t,e,n=s){if(this.elements=new g,this.ends={},this.each=i((t=>{var e;let n=this.ends[s];if(!n)return this;for(;n!==(null===(e=this.ends[1])||void 0===e?void 0:e[1])&&!1!==t(n);n=null==n?void 0:n[1]);return this})),o("no half-empty fragments",!t==!e),!t)return;o("withDir is passed to Fragment",t instanceof q),o("oppDir is passed to Fragment",e instanceof q),o("withDir and oppDir have the same parent",t.parent===(null==e?void 0:e.parent)),this.ends[n]=t,this.ends[n===s?1:s]=e;const r=this.fold([],((t,e)=>(t.push(...e.elements.contents),t)));this.elements.add(r)}withDirAdopt(t,e,n,i){return t===s?this.adopt(e,n,i):this.adopt(e,i,n)}adopt(t,e,n){a(t,e,n),this.disowned=!1;const i=this.ends[s];if(!i)return this;const r=this.ends[1];return e||(t.ends[s]=i),n?n[s]=r:t.ends[1]=r,this.ends[1][1]=n,this.each((n=>{n[s]=e,n.parent=t,e&&(e[1]=n),e=n})),this}disown(){const t=this.ends[s];if(!t||this.disowned)return this;this.disowned=!0;const e=this.ends[1],n=t.parent;return a(n,t[s],t),a(n,e,null==e?void 0:e[1]),t[s]?t[s][1]=null==e?void 0:e[1]:n.ends[s]=null==e?void 0:e[1],(null==e?void 0:e[1])?e[1][s]=t[s]:n.ends[1]=t[s],this}remove(){return this.elements.remove(),this.each("postOrder","dispose"),this.disown()}fold(t,e){let s=t;return this.each((t=>{s=e(s,t)})),s}}class x extends b{constructor(t,e,n=s){super(t,e,n);const i=document.createElement("span");i.classList.add("mq-selection"),this.elements.first.before(i),i.append(...this.elements.contents),this.elements=new g(i)}adopt(t,e,s){const n=this.elements.children();return this.elements.first.replaceWith(...n.contents),this.elements=n,super.adopt(t,e,s)}clear(){return this.elements.first.replaceWith(...this.elements.first.childNodes),this}join(t){return this.fold("",((e,s)=>e+s[t]()))}}const w=t=>o(`"${t}" should be overridden or never called on this node`);class q{constructor(){this.elements=new g,this.ends={},this.ctrlSeq="",this.bubble=i((t=>{for(let e=this;e&&!1!==t(e);e=e.parent);return this})),this.postOrder=i((t=>(function e(s){s.eachChild(e),t(s)}(this),this))),this.id=q.uniqueNodeId(),q.byId[this.id]=this}dispose(){delete q.byId[this.id]}toString(){return`{{ MathQuill TNode #${this.id} }}`}addToElements(t){this.elements.add(t)}domify(s){const n=s instanceof g?s:new g(this.html()),i=s=>{var n,r;if(s instanceof HTMLElement){const i=parseInt(null!==(n=s.getAttribute(t))&&void 0!==n?n:"0"),o=parseInt(null!==(r=s.getAttribute(e))&&void 0!==r?r:"0");i&&q.byId[i].addToElements(s),o&&q.byId[o].addToElements(s)}for(let t=s.firstChild;t;t=t.nextSibling)i(t)};return n.contents.forEach((t=>i(t))),n}createDir(t,e){return l(t),this.domify(),this.elements.insDirOf(t,e.element),e[t]=this.adopt(e.parent,e[s],e[1]),this}createLeftOf(t){this.createDir(s,t)}selectChildren(t,e){return new x(t,e)}isEmpty(){return!this.ends[s]&&!this.ends[1]}isStyleBlock(){return!1}children(){return new b(this.ends[s],this.ends[1])}eachChild(t,e){return this.children().each(t,e),this}foldChildren(t,e){return this.children().fold(t,e)}withDirAdopt(t,e,s,n){return new b(this,this).withDirAdopt(t,e,s,n),this}adopt(t,e,s){return new b(this,this).adopt(t,e,s),this}disown(){return new b(this,this).disown(),this}remove(){return this.elements.remove(),this.postOrder("dispose"),this.disown()}keystroke(t,e,n){const i=n.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":n.ctrlDeleteDir(s);break;case"Shift-Backspace":case"Backspace":n.backspace();break;case"Esc":case"Tab":return void n.escapeDir(1,t,e);case"Shift-Tab":case"Shift-Esc":return void n.escapeDir(s,t,e);case"End":n.notify("move").cursor.insAtRightEnd(i.parent);break;case"Ctrl-End":n.notify("move").cursor.insAtRightEnd(n.root);break;case"Shift-End":for(;i[1];)n.selectRight();break;case"Ctrl-Shift-End":for(;i[1]||i.parent!==n.root;)n.selectRight();break;case"Home":n.notify("move").cursor.insAtLeftEnd(i.parent);break;case"Ctrl-Home":n.notify("move").cursor.insAtLeftEnd(n.root);break;case"Shift-Home":for(;i[s];)n.selectLeft();break;case"Ctrl-Shift-Home":for(;i[s]||i.parent!==n.root;)n.selectLeft();break;case"Left":n.moveLeft();break;case"Shift-Left":n.selectLeft();break;case"Ctrl-Left":case"Ctrl-Right":case"Ctrl-Up":case"Ctrl-Down":break;case"Right":n.moveRight();break;case"Shift-Right":n.selectRight();break;case"Up":n.moveUp();break;case"Down":n.moveDown();break;case"Shift-Up":if(i[s])for(;i[s];)n.selectLeft();else n.selectLeft();break;case"Shift-Down":if(i[1])for(;i[1];)n.selectRight();else n.selectRight();break;case"Ctrl-Shift-Del":case"Ctrl-Del":n.ctrlDeleteDir(1);break;case"Shift-Del":case"Del":n.deleteForward();break;case"Meta-A":case"Ctrl-A":for(n.notify("move").cursor.insAtRightEnd(n.root);i[s];)n.selectLeft();break;default:return}e.preventDefault(),n.scrollHoriz()}html(){return""}text(){return""}latex(){return""}focus(){}blur(t){}seek(t,e){}writeLatex(t,e){}finalizeInsert(t,e){}write(t,e){}replaces(t){}setOptions(t){return this}chToCmd(t,e){return this}moveOutOf(t,e,s){w("moveOutOf")}moveTowards(t,e,s){w("moveTowards")}deleteOutOf(t,e){w("deleteOutOf")}deleteTowards(t,e){w("deleteTowards")}unselectInto(t,e){w("unselectInto")}selectOutOf(t,e){w("selectOutOf")}selectTowards(t,e){w("selectTowards")}}q.id=0,q.byId={},q.uniqueNodeId=()=>++q.id;class O{constructor(t,e,n){this.parent=t,this[s]=e,this[1]=n}static copy(t){return new O(t.parent,t[s],t[1])}}const E=t=>{t.moveOutOf=e=>{var s;return null===(s=t.controller)||void 0===s?void 0:s.handle("moveOutOf",e)},t.deleteOutOf=e=>{var s;return null===(s=t.controller)||void 0===s?void 0:s.handle("deleteOutOf",e)},t.selectOutOf=e=>{var s;return null===(s=t.controller)||void 0===s?void 0:s.handle("selectOutOf",e)},t.upOutOf=e=>{var s;return null===(s=t.controller)||void 0===s?void 0:s.handle("upOutOf",e)},t.downOutOf=e=>{var s;return null===(s=t.controller)||void 0===s?void 0:s.handle("downOutOf",e)},t.reflow=()=>{var e,s,n;null===(e=t.controller)||void 0===e||e.handle("reflow"),null===(s=t.controller)||void 0===s||s.handle("edited"),null===(n=t.controller)||void 0===n||n.handle("edit")}},y=t=>class extends t{moveTowards(t,e,n){const i=n&&this[`${n}Into`];e.insAtDirEnd(t===s?1:s,i||this.ends[t===s?1:s])}deleteTowards(t,e){this.isEmpty()?e[t]=this.remove()[t]:this.moveTowards(t,e)}selectTowards(t,e){e[t===s?1:s]=this,e[t]=this[t]}},S=(t,e,s)=>t.forEach((t=>t.style.transform=`scale(${e},${s})`)),_=t=>class extends t{constructor(){super(...arguments),this.reflow=()=>{var t,e,s;const n=this.content?getComputedStyle(this.content):void 0,i=null===(t=this.content)||void 0===t?void 0:t.getBoundingClientRect(),r=(null!==(e=null==i?void 0:i.height)&&void 0!==e?e:0)/parseFloat(null!==(s=null==n?void 0:n.fontSize)&&void 0!==s?s:"1");S(this.delims,Math.min(1+.2*(r-1),1.2),1.2*r)}}addToElements(t){super.addToElements(t);const e=this.elements.children();this.delims=[e.firstElement,e.lastElement],this.content=e.contents[1]}};class k{constructor(t){this._=t}parse(t){return this.skip(k.eof)._(`${t}`,((t,e)=>e),((t,e)=>{throw`Parse Error: ${e} at ${t||"EOF"}`}))}or(t){return o("or is passed a parser",t instanceof k),new k(((e,s,n)=>this._(e,s,(()=>t._(e,s,n)))))}then(t){return new k(((e,s,n)=>this._(e,((e,i)=>{const r=t instanceof k?t:"function"==typeof t?t(i):void 0;return o("a parser is returned",r instanceof k),r._(e,s,n)}),n)))}many(){return new k(((t,e)=>{const s=[];for(;this._(t,((e,n)=>(t=e,s.push(n),!0)),(()=>!1)););return e(t,s)}))}times(t,e=t){return new k(((s,n,i)=>{const r=[];let o=!0;for(let n=0;n<e&&o;++n){let e;if(o=this._(s,((t,e)=>(r.push(e),s=t,!0)),((t,n)=>(e=n,s=t,!1))),n<t&&!o)return i(s,e)}return n(s,r)}))}result(t){return this.then(k.succeed(t))}atMost(t){return this.times(0,t)}atLeast(t){return this.times(t).then((t=>this.many().map((e=>t.concat(e)))))}map(t){return this.then((e=>"function"==typeof t&&/^\s*class\s+/.test(t.toString())?k.succeed(new t(e)):"function"==typeof t?k.succeed(t(e)):k.fail("Invalid map function")))}skip(t){return this.then((e=>t.result(e)))}static string(t){return new k(((e,s,n)=>{const i=e.slice(0,t.length);return i===t?s(e.slice(t.length),i):n(e,`expected '${t}'`)}))}static regex(t){return o("regexp parser is anchored","^"===t.toString().charAt(1)),new k(((e,s,n)=>{const i=t.exec(e);return i?s(e.slice(i[0].length),i[0]):n(e,`expected ${t.toString()}`)}))}static succeed(t){return new k(((e,s)=>s(e,t)))}static fail(t){return new k(((e,s,n)=>n(e,t)))}}k.letter=k.regex(/^[a-z]/i),k.letters=k.regex(/^[a-z]*/i),k.digit=k.regex(/^[0-9]/),k.digits=k.regex(/^[0-9]*/),k.whitespace=k.regex(/^\s+/),k.optWhitespace=k.regex(/^\s*/),k.any=new k(((t,e,s)=>t?e(t.slice(1),t.charAt(0)):s(t,"expected any character"))),k.all=new k(((t,e)=>e("",t))),k.eof=new k(((t,e,s)=>t?s(t,"expected EOF"):e(t,t)));const C=t=>class extends t{focusBlurEvents(){var t,e,s;this.focusHandler=()=>{var t;this.blurred=!1,this.container.classList.add("mq-focused"),this.cursor.parent||this.cursor.insAtRightEnd(this.root),this.cursor.selection?(this.cursor.selection.elements.removeClass("mq-blur"),null===(t=this.selectionChanged)||void 0===t||t.call(this)):this.cursor.show()},null===(t=this.textarea)||void 0===t||t.addEventListener("focus",this.focusHandler),this.blurHandler=()=>{var t;this.blurred=!0,this.container.classList.remove("mq-focused"),null===(t=this.cursor.hide().parent)||void 0===t||t.blur(),this.cursor.selection&&this.cursor.selection.elements.addClass("mq-blur")},null===(e=this.textarea)||void 0===e||e.addEventListener("blur",this.blurHandler),this.blurred=!0,null===(s=this.cursor.hide().parent)||void 0===s||s.blur()}unbindFocusBlurEvents(){var t,e;this.focusHandler&&(null===(t=this.textarea)||void 0===t||t.removeEventListener("focus",this.focusHandler)),this.blurHandler&&(null===(e=this.textarea)||void 0===e||e.removeEventListener("blur",this.blurHandler)),delete this.focusHandler,delete this.blurHandler}},T=t=>class extends t{focus(){this.elements.addClass("mq-hasCursor"),this.elements.removeClass("mq-empty")}blur(){this.elements.removeClass("mq-hasCursor"),this.isEmpty()&&this.elements.addClass("mq-empty")}};class L extends q{finalizeInsert(t,e){var n,i,r,o;this.postOrder("finalizeTree",t),this.postOrder("contactWeld",e),this.postOrder("blur"),this.postOrder("reflow"),null===(i=null===(n=this[1])||void 0===n?void 0:n.siblingCreated)||void 0===i||i.call(n,t,s),null===(o=null===(r=this[s])||void 0===r?void 0:r.siblingCreated)||void 0===o||o.call(r,t,1),this.bubble("reflow")}prepareInsertionAt(t){const e=t.options.maxDepth;if(void 0!==e){const s=t.depth();if(s>e)return!1;this.removeNodesDeeperThan(e-s)}return!0}removeNodesDeeperThan(t){var e;let s=0;const n=[[this,s]];for(;n.length;){const i=n.shift();null===(e=null==i?void 0:i[0].children())||void 0===e||e.each((e=>{const r=e instanceof Q?1:0;s=i[1]+r,s<=t?n.push([e,s]):(r?e.children():e).remove()}))}}}class D extends(y(L)){constructor(t,e,s){super(),this.blocks=[],this.ctrlSeq=null!=t?t:"",this.htmlTemplate=null!=e?e:"",this.textTemplate=null!=s?s:[""]}replaces(t){null==t||t.disown(),this.replacedFragment=t}isEmpty(){return this.foldChildren(!0,((t,e)=>t&&e.isEmpty()))}parser(){return j.block.times(this.numBlocks()).map((t=>{this.blocks=t;for(const e of t)e.adopt(this,this.ends[1]);return this}))}createLeftOf(t){var e;const n=this.replacedFragment;this.createBlocks(),super.createLeftOf(t),n&&(n.adopt(this.ends[s]),null===(e=this.ends[s])||void 0===e||e.elements.firstElement.append(...n.elements.contents),this.placeCursor(t),this.prepareInsertionAt(t)),this.finalizeInsert(t.options),this.placeCursor(t)}createBlocks(){const t=this.numBlocks();this.blocks=Array(t);for(let e=0;e<t;++e)this.blocks[e]=new Q,this.blocks[e].adopt(this,this.ends[1])}placeCursor(t){t.insAtRightEnd(this.foldChildren(this.ends[s],((t,e)=>t.isEmpty()?t:e)))}selectChildren(){return new x(this,this)}unselectInto(t,e){var n,i;e.insAtDirEnd(t===s?1:s,null===(i=null===(n=e.anticursor)||void 0===n?void 0:n.ancestors)||void 0===i?void 0:i[this.id])}seek(t,e){const n=t=>{const e=t.elements.firstElement.getBoundingClientRect();return{[s]:e.left,1:e.left+e.width}},i=n(this);if(t<i[s])return void e.insLeftOf(this);if(t>i[1])return void e.insRightOf(this);let r=i[s];this.eachChild((o=>{const l=n(o);return t<l[s]?(t-r<l[s]-t?o[s]?e.insAtRightEnd(o[s]):e.insLeftOf(this):e.insAtLeftEnd(o),!1):t>l[1]?void(o[1]?r=l[1]:i[1]-t<t-l[1]?e.insRightOf(this):e.insAtRightEnd(o)):(o.seek(t,e),!1)}))}numBlocks(){const t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0}html(){const s=this.blocks,n=` ${t}=${this.id}`,i=this.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);o("no unmatched angle brackets",i.join("")===this.htmlTemplate);for(let t=0,e=i[0];e;++t,e=i[t])if("/>"===e.slice(-2))i[t]=`${e.slice(0,-2)}${n}/>`;else if("<"===e.charAt(0)){o("not an unmatched top-level close tag","/"!==e.charAt(1)),i[t]=`${e.slice(0,-1)}${n}>`;let s=1;do{t+=1,e=i[t],o("no missing close tags",!!e),"</"===e.slice(0,2)?s-=1:"<"===e.charAt(0)&&"/>"!==e.slice(-2)&&(s+=1)}while(s>0)}return i.join("").replace(/>&(\d+)/g,((t,n)=>{var i,r,o,l;return` ${e}=${null!==(r=null===(i=s[n])||void 0===i?void 0:i.id)&&void 0!==r?r:""}>${null!==(l=null===(o=s[n])||void 0===o?void 0:o.join("html"))&&void 0!==l?l:""}`}))}latex(){return this.foldChildren(this.ctrlSeq,((t,e)=>`${t}{${e.latex()||" "}}`))}text(){let t=0;return this.foldChildren(this.textTemplate[t],((e,s)=>{++t;const n=s.text();return e&&"("===this.textTemplate[t]&&"("===n[0]&&")"===n.slice(-1)?e+n.slice(1,-1)+this.textTemplate[t]:e+n+(this.textTemplate[t]||"")}))}}class $ extends D{constructor(t,e,s){const i=s||(t&&t.length>1?t.slice(1):null!=t?t:"");super(t,e,[i]),this.createBlocks=n,this.isSymbol=!0}parser(){return k.succeed(this)}numBlocks(){return 0}replaces(t){null==t||t.remove()}moveTowards(t,e){t===s?this.elements.first.before(e.element):this.elements.last.after(e.element),e[t===s?1:s]=this,e[t]=this[t]}deleteTowards(t,e){e[t]=this.remove()[t]}seek(t,e){const s=this.elements.firstElement.getBoundingClientRect();t-s.left<s.width/2?e.insLeftOf(this):e.insRightOf(this)}latex(){return this.ctrlSeq}text(){return this.textTemplate.join("")}placeCursor(){}isEmpty(){return!0}}class A extends ${constructor(t,e,s){super(t,`<span>${e||t}</span>`,s)}}class R extends ${constructor(t,e,s,n=!1){super(t,!0===n?e:`<span class="mq-binary-operator">${null!=e?e:""}</span>`,s),this.isUnary=!1}}class I extends R{constructor(t,e){const s=e?"Strict":"";super(t[`ctrlSeq${s}`],t[`html${s}`],t[`text${s}`]),this.data=t,this.strict=e}swap(t){this.strict=t;const e=t?"Strict":"";this.ctrlSeq=this.data[`ctrlSeq${e}`],this.elements.html(this.data[`html${e}`]),this.textTemplate=[this.data[`text${e}`]]}deleteTowards(t,e){if(t===s&&!this.strict)return this.swap(!0),void this.bubble("reflow");super.deleteTowards(t,e)}}class B extends R{constructor(){super("=","=")}createLeftOf(t){var e;if(t[s]instanceof I&&t[s].strict)return t[s].swap(!1),void(null===(e=t[s])||void 0===e||e.bubble("reflow"));super.createLeftOf(t)}}class N extends A{createLeftOf(t){var e,n,i,r,o;t.options.autoSubscriptNumerals&&t.parent!==(null===(n=null===(e=t.parent)||void 0===e?void 0:e.parent)||void 0===n?void 0:n.sub)&&(t[s]instanceof z&&!1!==t[s].isItalic||t[s]instanceof P&&(null===(i=t[s])||void 0===i?void 0:i[s])instanceof z&&!1!==(null===(r=t[s])||void 0===r?void 0:r[s]).isItalic)?((new c._).createLeftOf(t),super.createLeftOf(t),t.insRightOf(null===(o=t.parent)||void 0===o?void 0:o.parent)):super.createLeftOf(t)}}class z extends ${constructor(t,e){super(t,`<var>${e||t}</var>`),this.isItalic=!1,this.isPartOfOperator=!1}text(){let t=this.ctrlSeq;return this.isPartOfOperator&&("\\"==t[0]?t=t.startsWith("\\operatorname{")?t.slice(14,t.length):t.slice(1,t.length):" "!=t[t.length-1]&&"}"!=t[t.length-1]||(t=t.slice(0,-1),this[1]instanceof U||this[1]instanceof W||this[1]instanceof P||(t+=" "))),t}}class M extends z{constructor(t,e){super(t,e),this.letter=t,this.siblingDeleted=this.siblingCreated=(t,e)=>this.finalizeTree(t,e)}createLeftOf(t){super.createLeftOf(t);const e=t.options.autoCommands,n=e._maxLength;if(n>0){let i="",r=this,o=0;for(;r instanceof M&&(null==r?void 0:r.ctrlSeq)===(null==r?void 0:r.letter)&&o<n;)i=r.letter+i,r=r[s],++o;for(;i.length;){if(e[i]){for(o=1,r=this;o<i.length;++o,r=null==r?void 0:r[s]);return new b(r,this).remove(),t[s]=null==r?void 0:r[s],new c[i](i).createLeftOf(t)}i=i.slice(1)}}}italicize(t){return this.isItalic=t,this.isPartOfOperator=!t,this.elements.toggleClass("mq-operator-name",!t),this}finalizeTree(t,e){e!==s&&this[1]instanceof M||this.autoUnItalicize(t)}autoUnItalicize(t){var e,n,i,r,o,l,a;const c=t.autoOperatorNames;if(0===c._maxLength)return;let d=this.letter,h=this[s],u=this[1];for(;h instanceof M;h=h[s])d=h.letter+d;for(;u instanceof M;u=u[1])d+=u.letter;new b((null==h?void 0:h[1])||(null===(e=this.parent)||void 0===e?void 0:e.ends[s]),(null==u?void 0:u[s])||(null===(n=this.parent)||void 0===n?void 0:n.ends[1])).each((t=>{t.italicize(!0).elements.removeClass("mq-first","mq-last","mq-followed-by-supsub"),t.ctrlSeq=t.letter}));for(let e=0,n=(null==h?void 0:h[1])||(null===(i=this.parent)||void 0===i?void 0:i.ends[s]);e<d.length;++e,n=null==n?void 0:n[1])for(let i=Math.min(c._maxLength,d.length-e);i>0;--i){const h=d.slice(e,e+i);if(c[h]){let c;for(let t=0,e=n;t<i;t+=1,e=null==e?void 0:e[1])e.italicize(!1),c=e;const d=p[h];if(n.ctrlSeq=(d?"\\":"\\operatorname{")+(null!==(r=null==n?void 0:n.ctrlSeq)&&void 0!==r?r:""),c.ctrlSeq+=d?" ":"}",h in m&&(null===(a=null===(l=null===(o=null==c?void 0:c[s])||void 0===o?void 0:o[s])||void 0===l?void 0:l[s])||void 0===a||a.elements.addClass("mq-last")),this.shouldOmitPadding(null==n?void 0:n[s])||null==n||n.elements.addClass("mq-first"),!this.shouldOmitPadding(null==c?void 0:c[1]))if((null==c?void 0:c[1])instanceof P){const e=c[1];e.siblingCreated=e.siblingDeleted=()=>{e.elements.toggleClass("mq-after-operator-name",!(e[1]instanceof U))},e.siblingCreated(t)}else null==c||c.elements.toggleClass("mq-last",!((null==c?void 0:c[1])instanceof U));e+=i-1,n=c;break}}}shouldOmitPadding(t){return!t||t instanceof R||t instanceof H}}function F(t){var e;const s=this.parent;let n=t;do{if(null==n?void 0:n[1])return t.insLeftOf(s);n=null===(e=null==n?void 0:n.parent)||void 0===e?void 0:e.parent}while(n!==s);t.insRightOf(s)}class W extends D{constructor(){super(),this.ctrlSeq="\\frac",this.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',this.textTemplate=["((",")/(","))"]}text(){var t;let e=this[s];for(;e&&"\\ "===e.ctrlSeq;e=e[s]);const n=t=>{var e,n,i;let r=!1,o=0,l=!1;null===(e=this.ends[t])||void 0===e||e.eachChild((t=>(t instanceof N&&(l=!0),t instanceof N||t instanceof R&&t.isUnary||t instanceof P||++o,(l&&o||o>1||t instanceof R&&!t.isUnary||"text"in c&&t instanceof c.text||t instanceof H||t instanceof W||"\\ "===t.ctrlSeq||/^[,;:]$/.test(t.ctrlSeq))&&(r=!0),!r)));const a=t===s?0:1,d=" "!==(null===(n=this.ends[t])||void 0===n?void 0:n.text())&&(null===(i=this.ends[t])||void 0===i?void 0:i.text());return d?r?`(${d})`:d:a};return e instanceof R&&e.isUnary||(null==e?void 0:e.elements.hasClass("mq-operator-name"))||e instanceof P&&(null===(t=e[s])||void 0===t?void 0:t.elements.hasClass("mq-operator-name"))?`(${n(s)}/${n(1)})`:` ${n(s)}/${n(1)} `}finalizeTree(){this.upInto=this.ends[1].upOutOf=this.ends[s],this.downInto=this.ends[s].downOutOf=this.ends[1]}}class P extends D{constructor(t,e,s){super("_{...}^{...}",e,s),this.supsub="sup",this.reflow=()=>{const t=this.elements,e=t.first.previousElementSibling;if(!e)return;const s=t.children(".mq-sup").firstElement;if(s){const t=getComputedStyle(s),n=s.getBoundingClientRect(),i=parseInt(t.fontSize),r=n.top+n.height-parseFloat(t.paddingTop)-parseFloat(t.paddingBottom)-e.getBoundingClientRect().top-.7*i,o=parseInt(t.marginBottom);s.style.marginBottom=`${o+r}px`}}}hasValidBase(t){var e,n,i;return!(t.options.supSubsRequireOperand&&(!t[s]||"\\ "===(null===(e=t[s])||void 0===e?void 0:e.ctrlSeq)||t[s]instanceof R||/^[,;:]$/.test(null!==(i=null===(n=t[s])||void 0===n?void 0:n.ctrlSeq)&&void 0!==i?i:"")))}createLeftOf(t){if(this.hasValidBase(t)){if(t[s]instanceof W){const e=new U(1,"(",")","(",")");t.selection=t[s].selectChildren(),e.replaces(t.replaceSelection()),e.createLeftOf(t)}super.createLeftOf(t)}else this.replacedFragment&&(this.replacedFragment.adopt(t.parent,t[s],t[1]),t[s]=this.replacedFragment.ends[1])}contactWeld(t){var e,n;for(const e of[s,1])if(this[e]instanceof P){let n;for(const t of["sub","sup"]){const i=this[t],r=this[e][t];if(i){if(r)if(i.isEmpty())n=new O(r,void 0,r.ends[s]);else{i.elements.children().insAtDirEnd(e===s?1:s,r.elements);const t=i.children().disown();n=new O(r,t.ends[1],r.ends[s]),e===s?t.adopt(r,r.ends[1]):t.adopt(r,void 0,r.ends[s])}else this[e].addBlock(i.disown());this.placeCursor=t=>t.insAtDirEnd(e===s?1:s,r||i)}}return this.remove(),void(t&&(t[s]===this?1===e&&n?n[s]?t.insRightOf(n[s]):t.insAtLeftEnd(n.parent):t.insRightOf(this[e]):(null==n?void 0:n[1])&&t.insRightOf(n[1])))}if(t&&t[1]===this&&(!this.hasValidBase(t)||t[s]instanceof W)){for(const i of["sub","sup"]){const r=this[i];r&&(r.children().disown().adopt(t.parent,t[s],t[1]).elements.insDirOf(1,t.element),(null===(e=t[s])||void 0===e?void 0:e[1])?t.insLeftOf(null===(n=t[s])||void 0===n?void 0:n[1]):t.insAtDirEnd(s,t.parent))}this.remove()}}finalizeTree(){this.ends[s].isSupSubLeft=!0}moveTowards(t,e,s){e.options.autoSubscriptNumerals&&!this.sup?e.insDirOf(t,this):super.moveTowards(t,e,s)}deleteTowards(t,e){if(e.options.autoSubscriptNumerals&&this.sub){const n=this.sub.ends[t===s?1:s];n instanceof $?n.remove():n&&n.deleteTowards(t,e.insAtDirEnd(t===s?1:s,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(s,e.insAtLeftEnd(this.sub)),this.sup&&e.insDirOf(t===s?1:s,this))}else super.deleteTowards(t,e)}latex(){const t=(t,e)=>{const s=e&&e.latex();return e?t+(1===(null==s?void 0:s.length)?s:`{${s||" "}}`):""};return t("_",this.sub)+t("^",this.sup)}text(){const t=(t,e)=>{let s=!1,n=0,i=!1;null==e||e.eachChild((t=>(t instanceof N&&(i=!0),t instanceof N||t instanceof R&&t.isUnary||++n,(i&&n||n>1||t instanceof R&&!t.isUnary||"text"in c&&t instanceof c.text||t instanceof H||t instanceof W||"\\ "===t.ctrlSeq||/^[,;:]$/.test(t.ctrlSeq))&&(s=!0),!s)));const r=" "!==(null==e?void 0:e.text())&&(null==e?void 0:e.text());return r?t+(s?`(${r})`:r):""},e=t("_",this.sub)+t("^",this.sup);return e+(e&&this[1]instanceof N?" ":"")}addBlock(t){if("sub"===this.supsub){this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub).downOutOf=this.sub;const s=document.createElement("span");s.classList.add("mq-sup"),s.append(...t.elements.children().contents),s.setAttribute(e,t.id.toString()),this.elements.firstElement.prepend(s),t.elements=new g(s)}else{this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,void 0,this.sup).upOutOf=this.sup;const s=document.createElement("span");s.classList.add("mq-sub"),s.append(...t.elements.children().contents),s.setAttribute(e,t.id.toString()),this.elements.removeClass("mq-sup-only"),this.elements.firstElement.append(s),t.elements=new g(s);const n=document.createElement("span");n.style.display="inline-block",n.style.width="0",n.textContent="​",this.elements.firstElement.append(n)}for(const t of["sub","sup"]){const e="sub"===t?"sup":"sub",n="sub"===t?"down":"up",i=this[t];i.deleteOutOf=(r,o)=>{var l;if(o.insDirOf(i[r]?r===s?1:s:r,i.parent),!i.isEmpty()){const t=i.ends[r];i.children().disown().withDirAdopt(r,o.parent,o[r],o[r===s?1:s]).elements.insDirOf(r===s?1:s,o.element),o[r===s?1:s]=t}this.supsub=e,delete this[t],delete this[`${n}Into`],this[e][`${n}OutOf`]=F,delete this[e].deleteOutOf,"sub"===t&&(this.elements.addClass("mq-sup-only"),null===(l=this.elements.first.lastChild)||void 0===l||l.remove()),i.remove()}}}}class H extends D{latex(){var t,e,n,i;const r=t=>1===t.length?t:`{${t||" "}}`;return`${this.ctrlSeq}_${r(null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.latex())&&void 0!==e?e:"")}^${r(null!==(i=null===(n=this.ends[1])||void 0===n?void 0:n.latex())&&void 0!==i?i:"")}`}text(){var t,e,n,i;return`${this.ctrlSeq.slice(1,this.ctrlSeq.length-1)}(${null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.text())&&void 0!==e?e:""},${null!==(i=null===(n=this.ends[1])||void 0===n?void 0:n.text())&&void 0!==i?i:""})`}parser(){const t=this.blocks=[new Q,new Q];for(const e of t)e.adopt(this,this.ends[1]);return k.optWhitespace.then(k.string("_").or(k.string("^"))).then((e=>{const s=t["_"===e?0:1];return j.block.then((t=>(t.children().adopt(s,s.ends[1]),k.succeed(this))))})).many().result(this)}finalizeTree(){this.downInto=this.ends[s],this.upInto=this.ends[1],this.ends[s].upOutOf=this.ends[1],this.ends[1].downOutOf=this.ends[s]}}class U extends(_(D)){constructor(t,e,i,r,o){super(`\\left${r}`,void 0,[e,i]),this.side=t,this.sides={[s]:{ch:e,ctrlSeq:r},1:{ch:i,ctrlSeq:o}},this.placeCursor=n,this.siblingCreated=(t,e)=>{e===(this.side===s?1:s)&&this.finalizeTree()}}numBlocks(){return 1}html(){return this.htmlTemplate=`<span class="mq-non-leaf"><span class="mq-scaled mq-paren${1===this.side?" mq-ghost":""}">`+this.sides[s].ch+'</span><span class="mq-non-leaf">&0</span>'+`<span class="mq-scaled mq-paren${this.side===s?" mq-ghost":""}">`+this.sides[1].ch+"</span></span>",super.html()}latex(){var t,e,n,i,r,o;return`\\left${null!==(e=null===(t=this.sides[s])||void 0===t?void 0:t.ctrlSeq)&&void 0!==e?e:""}${null!==(i=null===(n=this.ends[s])||void 0===n?void 0:n.latex())&&void 0!==i?i:""}\\right${null!==(o=null===(r=this.sides[1])||void 0===r?void 0:r.ctrlSeq)&&void 0!==o?o:""}`}text(){var t,e,n,i,r,o;return`${null!==(e=null===(t=this.sides[s])||void 0===t?void 0:t.ch)&&void 0!==e?e:""}${null!==(i=null===(n=this.ends[s])||void 0===n?void 0:n.text())&&void 0!==i?i:""}${null!==(o=null===(r=this.sides[1])||void 0===r?void 0:r.ch)&&void 0!==o?o:""}`}matchBrack(t,e,n){return n instanceof U&&n.side&&n.side!==(e===s?1:1===e?s:void 0)&&(!t.restrictMismatchedBrackets||h[this.sides[this.side].ch]===n.sides[n.side].ch||{"(":"]","[":")"}[this.sides[s].ch]===n.sides[1].ch)&&n}closeOpposing(t){var e;t.side=0,t.sides[this.side]=this.sides[this.side];const n=null===(e=t.delims)||void 0===e?void 0:e[this.side===s?0:1];n&&(n.classList.remove("mq-ghost"),n.innerHTML=this.sides[this.side].ch)}createLeftOf(t){var e,n,i,r,o;let l,a;if(!this.replacedFragment){const i=t.options;if("|"===this.sides[s].ch)l=this.matchBrack(i,1,t[1])||this.matchBrack(i,s,t[s])||this.matchBrack(i,void 0,null===(e=t.parent)||void 0===e?void 0:e.parent);else{const e=this.side===s?1:s;l=this.matchBrack(i,e,t[e])||this.matchBrack(i,e,null===(n=t.parent)||void 0===n?void 0:n.parent)}}l?(a=this.side=l.side===s?1:s,this.closeOpposing(l),l===(null===(i=t.parent)||void 0===i?void 0:i.parent)&&t[a]&&new b(t[a],null===(r=t.parent)||void 0===r?void 0:r.ends[a],a===s?1:s).disown().withDirAdopt(a===s?1:s,l.parent,l,l[a]).elements.insDirOf(a,l.elements),l.bubble("reflow")):(l=this,a=l.side,l.replacedFragment?l.side=0:t[a===s?1:s]&&(l.replaces(new b(t[a===s?1:s],null===(o=t.parent)||void 0===o?void 0:o.ends[a===s?1:s],a)),delete t[a===s?1:s]),super.createLeftOf(t)),a===s?t.insAtLeftEnd(l.ends[s]):t.insRightOf(l)}unwrap(){var t;const e=null===(t=this.ends[s])||void 0===t?void 0:t.children().disown().adopt(this.parent,this,this[1]);e&&this.elements.last.after(...e.elements.contents),this.remove()}deleteSide(t,e,n){var i,r,o,l,a,c,d,u,p,m,f,v;const g=this.parent,x=this[t],w=g.ends[t];if(t===this.side)return this.unwrap(),void(x?n.insDirOf(t===s?1:s,x):n.insAtDirEnd(t,g));const q=!this.side;if(this.side=t===s?1:s,this.matchBrack(n.options,t,null===(i=this.ends[s])||void 0===i?void 0:i.ends[this.side])){this.closeOpposing(null===(r=this.ends[s])||void 0===r?void 0:r.ends[this.side]);const e=null===(o=this.ends[s])||void 0===o?void 0:o.ends[t];this.unwrap(),null===(l=null==e?void 0:e.siblingCreated)||void 0===l||l.call(e,n.options,t),x?n.insDirOf(t===s?1:s,x):n.insAtDirEnd(t,g)}else{if(this.matchBrack(n.options,t,null===(a=this.parent)||void 0===a?void 0:a.parent))(null===(c=this.parent)||void 0===c?void 0:c.parent).closeOpposing(this),(null===(d=this.parent)||void 0===d?void 0:d.parent).unwrap();else{if(e&&q)return this.unwrap(),void(x?n.insDirOf(t===s?1:s,x):n.insAtDirEnd(t,g));this.sides[t]={ch:h[this.sides[this.side].ch],ctrlSeq:h[this.sides[this.side].ctrlSeq]},null===(u=this.delims)||void 0===u||u.forEach(((e,n)=>{e.classList.remove("mq-ghost"),n===(t===s?0:1)&&(e.classList.add("mq-ghost"),e.innerHTML=this.sides[t].ch)}))}if(x){const e=null===(p=this.ends[s])||void 0===p?void 0:p.ends[t];null===(m=this.ends[s])||void 0===m||m.elements.removeClass("mq-empty"),new b(x,w,t===s?1:s).disown().withDirAdopt(t===s?1:s,this.ends[s],e).elements.insAtDirEnd(t,null===(f=this.ends[s])||void 0===f?void 0:f.elements),null===(v=null==e?void 0:e.siblingCreated)||void 0===v||v.call(e,n.options,t),n.insDirOf(t===s?1:s,x)}else e?n.insDirOf(t,this):n.insAtDirEnd(t,this.ends[s])}}deleteTowards(t,e){this.deleteSide(t===s?1:s,!1,e)}finalizeTree(){this.ends[s].deleteOutOf=(t,e)=>{var n;return(null===(n=this.ends[s])||void 0===n?void 0:n.parent).deleteSide(t,!0,e)},this.finalizeTree=()=>{var t;null===(t=this.delims)||void 0===t||t[this.side===s?1:0].classList.remove("mq-ghost"),this.side=0}}}const j=(()=>{const t=t=>{const e=t[0]||new Q;for(const s of t.slice(1))s.children().adopt(e,e.ends[1]);return e},e=k.letter.map((t=>new M(t))),s=k.regex(/^\d/).map((t=>new N(t))),n=k.regex(/^[^${}\\_^]/).map((t=>new A(t))),i=k.regex(/^[^\\a-eg-zA-Z]/).or(k.string("\\").then(k.regex(/^[a-z]+/i).or(k.regex(/^\s+/).result(" ")).or(k.any))).then((t=>{const e=c[t];return e?new e(t).parser():k.fail(`unknown command: \\${t}`)})).or(e).or(s).or(n),r=k.string("{").then((()=>l)).skip(k.string("}")),o=k.optWhitespace.then(r.or(i.map((t=>{const e=new Q;return t.adopt(e),e})))),l=o.many().map(t).skip(k.optWhitespace),a=k.string("[").then(o.then((t=>"]"!==t.join("latex")?k.succeed(t):k.fail())).many().map(t).skip(k.optWhitespace)).skip(k.string("]")),d=l;return d.block=o,d.optBlock=a,d})(),V=t=>class extends t{chToCmd(t,e){const s=d[t]||c[t];return t.match(/^[a-eg-zA-Z]$/)?new M(t):/^\d$/.test(t)?new N(t):e&&e.typingSlashWritesDivisionSymbol&&"/"===t?new c["÷"](t):e&&e.typingAsteriskWritesTimesSymbol&&"*"===t?new c["×"](t):s?new s(t):new A(t)}write(t,e){var n;if(this.isSupSubLeft){if(t.options.autoSubscriptNumerals&&this===(null===(n=this.parent)||void 0===n?void 0:n.sub)){if("_"===e)return;const s=this.chToCmd(e,t.options);return s.isSymbol?t.deleteSelection():t.clearSelection().insRightOf(this.parent),void s.createLeftOf(t.show())}t[s]&&!t[1]&&!t.selection&&t.options.charsThatBreakOutOfSupSub.indexOf(e)>-1&&t.insRightOf(this.parent)}const i=this.chToCmd(e,t.options);t.selection&&i.replaces(t.replaceSelection()),t.isTooDeep()||i.createLeftOf(t.show())}};class Q extends(T(V(L))){join(t){return this.foldChildren("",((e,s)=>e+s[t]()))}html(){return this.join("html")}latex(){return this.join("latex")}text(){var t,e;return this.ends[s]&&this.ends[s]===this.ends[1]?null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.text())&&void 0!==e?e:"":this.join("text")}keystroke(t,e,n){return n.options.spaceBehavesLikeTab&&n.cursor.depth()>1&&("Spacebar"===t||"Shift-Spacebar"===t)?(e.preventDefault(),void n.escapeDir("Shift-Spacebar"===t?s:1,t,e)):super.keystroke(t,e,n)}moveOutOf(t,e,n){var i;!(n&&(null===(i=this.parent)||void 0===i?void 0:i[`${n}Into`]))&&this[t]?e.insAtDirEnd(t===s?1:s,this[t]):e.insDirOf(t,this.parent)}selectOutOf(t,e){e.insDirOf(t,this.parent)}deleteOutOf(t,e){e.unwrapGramp()}seek(t,e){var n,i,r,o,l,a;let c=this.ends[1];const d=null!==(n=null==c?void 0:c.elements.firstElement.getBoundingClientRect())&&void 0!==n?n:void 0;if(!c||(null!==(i=null==d?void 0:d.left)&&void 0!==i?i:0)+(null!==(r=null==d?void 0:d.width)&&void 0!==r?r:0)<t)e.insAtRightEnd(this);else if(t<(null!==(l=null===(o=this.ends[s])||void 0===o?void 0:o.elements.firstElement.getBoundingClientRect().left)&&void 0!==l?l:0))e.insAtLeftEnd(this);else{for(;t<(null!==(a=null==c?void 0:c.elements.firstElement.getBoundingClientRect().left)&&void 0!==a?a:0);)c=null==c?void 0:c[s];null==c||c.seek(t,e)}}writeLatex(t,e){var n,i,r,o,l,a,c;const d=k.all,h=k.eof,u=j.skip(h).or(d.result(!1)).parse(e);if(u&&!u.isEmpty()&&u.prepareInsertionAt(t)){u.children().adopt(t.parent,t[s],t[1]);const e=u.domify();t.element.before(...e.contents),t[s]=u.ends[1],u.finalizeInsert(t.options,t),null===(r=null===(i=null===(n=u.ends[1])||void 0===n?void 0:n[1])||void 0===i?void 0:i.siblingCreated)||void 0===r||r.call(i,t.options,s),null===(a=null===(l=null===(o=u.ends[s])||void 0===o?void 0:o[s])||void 0===l?void 0:l.siblingCreated)||void 0===a||a.call(l,t.options,1),null===(c=t.parent)||void 0===c||c.bubble("reflow")}}focus(){return super.focus(),this}blur(){return super.blur(),this}}class G extends Q{constructor(){super(),E(this)}}class K extends(V(D)){constructor(t){super("$"),this.cursor=t,this.htmlTemplate='<span class="mq-math-mode">&0</span>'}createBlocks(){super.createBlocks();const t=this.ends[s];t.write=(e,n)=>{var i;"$"!==n?this.write(e,n):t.isEmpty()?(e.insRightOf(t.parent),null===(i=t.parent)||void 0===i||i.deleteTowards(s,e),new A("\\$","$").createLeftOf(e.show())):e[1]?e[s]?this.write(e,n):e.insLeftOf(t.parent):e.insRightOf(t.parent)}}latex(){var t,e;return`$${null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.latex())&&void 0!==e?e:""}$`}}class Z extends O{constructor(t,e){super(t),this.element=document.createElement("span"),this.upDownCache={},this.blink=()=>this.element.classList.toggle("mq-blink"),this.options=e,this.element.classList.add("mq-cursor"),this.element.textContent="​"}show(){var t,e;return this.element.classList.remove("mq-blink"),this.element.style.display="",this.intervalId?clearInterval(this.intervalId):(this[1]?this.selection&&(null===(t=this.selection.ends[s])||void 0===t?void 0:t[s])===this[s]?this.selection.elements.first.before(this.element):this[1].elements.first.before(this.element):this.parent.elements.firstElement.append(this.element),null===(e=this.parent)||void 0===e||e.focus()),this.intervalId=setInterval(this.blink,500),this}hide(){return this.intervalId&&clearInterval(this.intervalId),delete this.intervalId,this.element.style.display="none",this.element.remove(),this}withDirInsertAt(t,e,n,i){const r=this.parent;this.parent=e,this[t]=n,this[t===s?1:s]=i,r!==e&&r.blur&&r.blur(this)}insDirOf(t,e){var n;return l(t),t===s?e.elements.first.before(this.element):e.elements.last.after(this.element),this.withDirInsertAt(t,e.parent,e[t],e),null===(n=this.parent)||void 0===n||n.elements.addClass("mq-hasCursor"),this}insLeftOf(t){return this.insDirOf(s,t)}insRightOf(t){return this.insDirOf(1,t)}insAtDirEnd(t,e){return l(t),t===s?e.elements.firstElement.prepend(this.element):e.elements.lastElement.append(this.element),this.withDirInsertAt(t,e,void 0,e.ends[t]),e.focus(),this}insAtLeftEnd(t){return this.insAtDirEnd(s,t)}insAtRightEnd(t){return this.insAtDirEnd(1,t)}jumpUpDown(t,e){this.upDownCache[t.id]=O.copy(this);const s=this.upDownCache[e.id];s?s[1]?this.insLeftOf(s[1]):this.insAtRightEnd(s.parent):e.seek(this.offset().left,this)}offset(){return this.element.getBoundingClientRect()}unwrapGramp(){var t,e,n,i,r,o,l,a,c,d;const h=null===(t=this.parent)||void 0===t?void 0:t.parent,u=h.parent,p=h[1];let m=h[s];if(h.disown().eachChild((t=>{t.isEmpty()||(t.children().adopt(u,m,p).each((t=>{h.elements.first.before(...t.elements.contents)})),m=t.ends[1])})),!this[1])if(this[s])this[1]=null===(e=this[s])||void 0===e?void 0:e[1];else for(;!this[1];){if(this.parent=null===(n=this.parent)||void 0===n?void 0:n[1],!this.parent){this[1]=h[1],this.parent=u;break}this[1]=null===(i=this.parent)||void 0===i?void 0:i.ends[s]}this[1]?this.insLeftOf(this[1]):this.insAtRightEnd(u),h.elements.remove(),(null===(r=h[s])||void 0===r?void 0:r.siblingDeleted)&&(null===(l=null===(o=h[s])||void 0===o?void 0:o.siblingDeleted)||void 0===l||l.call(o,this.options,1)),(null===(a=h[1])||void 0===a?void 0:a.siblingDeleted)&&(null===(d=null===(c=h[1])||void 0===c?void 0:c.siblingDeleted)||void 0===d||d.call(c,this.options,s))}startSelection(){this.anticursor=O.copy(this),this.anticursor.ancestors={};for(let t=this.anticursor;t.parent;t=t.parent)this.anticursor.ancestors[t.parent.id]=t}endSelection(){delete this.anticursor}select(){var t,e,n,i,r;if(this[s]===(null===(t=this.anticursor)||void 0===t?void 0:t[s])&&this.parent===(null===(e=this.anticursor)||void 0===e?void 0:e.parent))return!1;if(o("selection well formed",!!this.anticursor&&!!this.anticursor.ancestors),!this.anticursor||!this.anticursor.ancestors)return!1;let l=this,a=null;for(;l.parent;l=l.parent)if(l.parent.id in this.anticursor.ancestors){a=l.parent;break}o("cursor and anticursor in the same tree",!!a);const c=this.anticursor.ancestors[null!==(n=null==a?void 0:a.id)&&void 0!==n?n:0];let d,h,u=1;if(l[s]!==c)for(let t=l;t;t=t[1])if(t[1]===c[1]){u=s,d=l,h=c;break}return 1===u&&(d=c,h=l),d instanceof O&&(d=d[1]),h instanceof O&&(h=h[s]),this.hide().selection=null==a?void 0:a.selectChildren(d,h),this.insDirOf(u,null===(i=this.selection)||void 0===i?void 0:i.ends[u]),null===(r=this.selectionChanged)||void 0===r||r.call(this),!0}clearSelection(){var t;return this.selection&&(this.selection.clear(),delete this.selection,null===(t=this.selectionChanged)||void 0===t||t.call(this)),this}deleteSelection(){var t,e,n;this.selection&&(this[s]=null===(t=this.selection.ends[s])||void 0===t?void 0:t[s],this[1]=null===(e=this.selection.ends[1])||void 0===e?void 0:e[1],this.selection.remove(),null===(n=this.selectionChanged)||void 0===n||n.call(this),delete this.selection)}replaceSelection(){var t,e;const n=this.selection;return n&&(this[s]=null===(t=n.ends[s])||void 0===t?void 0:t[s],this[1]=null===(e=n.ends[1])||void 0===e?void 0:e[1],delete this.selection),n}depth(){let t=this.parent,e=0;for(;t;)e+=t instanceof Q?1:0,t=t.parent;return e}isTooDeep(t){if(void 0!==this.options.maxDepth)return this.depth()+(t||0)>this.options.maxDepth}}const X=t=>class extends t{scrollHoriz(){const t=this.root.elements.firstElement.getBoundingClientRect();let e=0;if(this.cursor.selection){const n=this.cursor.selection.elements.firstElement.getBoundingClientRect(),i=n.left-(t.left+20),r=n.right-(t.right-20);if(this.cursor.selection.ends[s]===this.cursor[1])if(i<0)e=i;else{if(!(r>0))return;e=n.left-r<t.left+20?i:r}else if(r>0)e=r;else{if(!(i<0))return;e=n.right-i>t.right-20?r:i}}else{const s=this.cursor.element.getBoundingClientRect().left;if(s>t.right-20)e=s-(t.right-20);else{if(!(s<t.left+20))return;e=s-(t.left+20)}}setTimeout((()=>this.root.elements.firstElement.scrollLeft+=e),100)}},Y=t=>class extends t{exportLatex(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")}writeLatex(t){var e;const s=this.notify("edit").cursor;return null===(e=s.parent)||void 0===e||e.writeLatex(s,t),this}renderLatexMath(t){const e=j.skip(k.eof).or(k.all.result(!1)).parse(t);if(this.root.eachChild("postOrder","dispose"),delete this.root.ends[s],delete this.root.ends[1],e&&e.prepareInsertionAt(this.cursor)){e.children().adopt(this.root);const t=e.join("html");this.root.elements.html(t),this.root.domify(this.root.elements.children()),this.root.finalizeInsert(this.cursor.options)}else this.root.elements.empty();delete this.cursor.selection,this.cursor.insAtRightEnd(this.root)}renderLatexText(t){this.root.elements.children().contents.slice(1).forEach((t=>t.remove())),this.root.eachChild("postOrder","dispose"),delete this.root.ends[s],delete this.root.ends[1],delete this.cursor.selection,this.cursor.show().insAtRightEnd(this.root);const e=k.string("$").then(j).skip(k.string("$").or(k.eof)).map((t=>{const e=new K(this.cursor);e.createBlocks();const n=e.ends[s];return t.children().adopt(n),e})),n=k.string("\\$").result("$").or(k.regex(/^[^$]/)).map(A),i=e.or(n).many().skip(k.eof).or(k.all.result(!1)).parse(t);if(i){for(const t of i)t.adopt(this.root,this.root.ends[1]);this.root.elements.lastElement.append(...this.root.domify().contents),this.root.finalizeInsert(this.cursor.options)}}},J=s=>class extends s{delegateMouseEvents(){const t=this.root.elements.firstElement;this.mouseDownHandler=s=>{var i,r;const o=s.target.closest(".mq-root-block"),l=q.byId[parseInt(null!==(i=(null==o?void 0:o.getAttribute(e))||(null==t?void 0:t.getAttribute(e)))&&void 0!==i?i:"0")];if(!l.controller)throw"controller undefined... what?";const a=l.controller,c=a.cursor,d=c.blink,h=a.textareaSpan,u=a.textarea;if(s.preventDefault(),c.options.ignoreNextMousedown(s))return;c.options.ignoreNextMousedown=()=>!1,c.endSelection();const p=s.target.ownerDocument;let m;const f=t=>m=t.target,v=t=>{var e;c.anticursor||c.startSelection(),a.seek(m,null!==(e=t.pageX)&&void 0!==e?e:0).cursor.select(),m=void 0},g=()=>{c.blink=d,c.selection||(a.editable?c.show():null==h||h.remove()),null==o||o.removeEventListener("mousemove",f),p.removeEventListener("mousemove",v),p.removeEventListener("mouseup",g)};a.blurred&&(a.editable||null==o||o.prepend(h),null==u||u.focus()),c.blink=n,a.seek(s.target,null!==(r=s.pageX)&&void 0!==r?r:0).cursor.startSelection(),null==o||o.addEventListener("mousemove",f),p.addEventListener("mousemove",v),p.addEventListener("mouseup",g)},this.container.addEventListener("mousedown",this.mouseDownHandler)}seek(s,n){var i,r;const l=this.notify("select").cursor;let a=0;if(s&&(a=parseInt(null!==(i=s.getAttribute(e)||s.getAttribute(t))&&void 0!==i?i:"0"),!a)){const n=s.parentElement;a=parseInt(null!==(r=(null==n?void 0:n.getAttribute(e))||(null==n?void 0:n.getAttribute(t)))&&void 0!==r?r:"0")}const c=a?q.byId[a]:this.root;return o("nodeId is the id of some TNode that exists",!!c),l.clearSelection().show(),c.seek(n,l),this.scrollHoriz(),this}},tt=t=>class extends t{exportText(){return this.root.foldChildren("",((t,e)=>t+e.text()))}},et=t=>class extends t{createTextarea(){this.textareaSpan=document.createElement("span"),this.textareaSpan.classList.add("mq-textarea");const t=this.options.substituteTextarea();if(!t.nodeType)throw"substituteTextarea() must return a DOM element, got "+t.toString();this.textareaSpan.append(t),this.textarea=t,this.cursor.selectionChanged=()=>this.selectionChanged()}selectionChanged(){this.textareaSelectionTimeout||(this.textareaSelectionTimeout=setTimeout((()=>this.setTextareaSelection())))}setTextareaSelection(){var t;delete this.textareaSelectionTimeout;let e="";this.cursor.selection&&(e=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(e=`$${e}$`)),null===(t=this.selectFn)||void 0===t||t.call(this,e)}staticMathTextareaEvents(){var t,e,s,n,i;const r=document.createElement("span");r.classList.add("mq-selectable"),r.textContent=`$${this.exportLatex()}$`,this.container.prepend(r),this.blurred=!0,null===(t=this.textarea)||void 0===t||t.addEventListener("cut",(t=>{t.stopPropagation(),t.preventDefault()})),null===(e=this.textarea)||void 0===e||e.addEventListener("paste",(t=>{t.stopPropagation(),t.preventDefault()})),null===(s=this.textarea)||void 0===s||s.addEventListener("copy",(()=>this.setTextareaSelection())),null===(n=this.textarea)||void 0===n||n.addEventListener("focus",(()=>this.blurred=!1)),null===(i=this.textarea)||void 0===i||i.addEventListener("blur",(()=>{this.cursor.selection&&this.cursor.selection.clear(),setTimeout((()=>{var t;null===(t=this.textareaSpan)||void 0===t||t.remove(),this.blurred=!0}))})),this.selectFn=t=>{var e;this.textarea&&(this.textarea.value=t),t&&(null===(e=this.textarea)||void 0===e||e.select())}}editablesTextareaEvents(){const t=this.options.substituteKeyboardEvents(this.textarea,this);this.selectFn=e=>t.select(e),this.container.prepend(this.textareaSpan),this.focusBlurEvents()}unbindEditablesEvents(){var t,e,s;this.selectFn=t=>{var e;this.textarea&&(this.textarea.value=t),t&&(null===(e=this.textarea)||void 0===e||e.select())},null===(t=this.textareaSpan)||void 0===t||t.remove(),this.unbindFocusBlurEvents(),this.blurred=!0,null===(e=this.textarea)||void 0===e||e.addEventListener("cut",(t=>{t.stopPropagation(),t.preventDefault()})),null===(s=this.textarea)||void 0===s||s.addEventListener("paste",(t=>{t.stopPropagation(),t.preventDefault()}))}typedText(t){var e;if("\n"===t)return this.handle("enter");const s=this.notify().cursor;null===(e=s.parent)||void 0===e||e.write(s,t),this.scrollHoriz()}cut(){this.cursor.selection&&setTimeout((()=>{var t;this.notify("edit"),null===(t=this.cursor.parent)||void 0===t||t.bubble("reflow")}))}copy(){this.setTextareaSelection()}paste(t){this.options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):`\\text{${t}}`),this.writeLatex(t).cursor.show()}keystroke(t,e){}};class st{constructor(t,e,s){this.KIND_OF_MQ="",this.editable=!1,this.id=t.id,this.root=t,this.container=e,this.options=s,this.cursor=new Z(t,s)}handle(t,e){var n,i;const r=this.options.handlers;r&&r[t]&&(e===s||1===e?null===(n=r[t])||void 0===n||n(e,this.apiClass):null===(i=r[t])||void 0===i||i(this.apiClass))}notify(t){return"move"!==t&&"upDown"!==t||this.cursor.show().clearSelection(),"upDown"!==t&&(this.cursor.upDownCache={}),"edit"===t&&this.cursor.show().deleteSelection(),"select"!==t&&this.cursor.endSelection(),this}selectionChanged(){}}class nt extends(tt(et(Y(C(J(X(st))))))){constructor(t,e,s){super(t,e,s),t.controller=this}keystroke(t,e){var s;null===(s=this.cursor.parent)||void 0===s||s.keystroke(t,e,this)}escapeDir(t,e,s){var n;l(t);const i=this.cursor;if(i.parent!==this.root&&s.preventDefault(),i.parent!==this.root)return null===(n=i.parent)||void 0===n||n.moveOutOf(t,i),this.notify("move")}moveDir(t){var e,s;l(t);const n=this.cursor,i=n.options.leftRightIntoCmdGoes;return n.selection?n.insDirOf(t,n.selection.ends[t]):n[t]?null===(e=n[t])||void 0===e||e.moveTowards(t,n,i):null===(s=n.parent)||void 0===s||s.moveOutOf(t,n,i),this.notify("move")}moveLeft(){return this.moveDir(s)}moveRight(){return this.moveDir(1)}moveUpDown(t){var e,n,i,r,o;const l=this.notify("upDown").cursor,a=`${t}Into`,c=`${t}OutOf`;return(null===(e=l[1])||void 0===e?void 0:e[a])?l.insAtLeftEnd(null===(n=l[1])||void 0===n?void 0:n[a]):(null===(i=l[s])||void 0===i?void 0:i[a])?l.insAtRightEnd(null===(r=l[s])||void 0===r?void 0:r[a]):null===(o=l.parent)||void 0===o||o.bubble((t=>{if(t[c]&&("function"==typeof t[c]&&t[c](l),t[c]instanceof q&&l.jumpUpDown(t,t[c]),!0!==t[c]))return!1})),this}moveUp(){return this.moveUpDown("up")}moveDown(){return this.moveUpDown("down")}deleteDir(t){var e,n,i,r,o,a,c,d;l(t);const h=this.cursor,u=h.selection;return this.notify("edit"),u||(h[t]?null===(e=h[t])||void 0===e||e.deleteTowards(t,h):null===(n=h.parent)||void 0===n||n.deleteOutOf(t,h)),null===(i=h[1])||void 0===i||i.postOrder("contactWeld",h),null===(o=null===(r=h[s])||void 0===r?void 0:r.siblingDeleted)||void 0===o||o.call(r,h.options,1),null===(c=null===(a=h[1])||void 0===a?void 0:a.siblingDeleted)||void 0===c||c.call(a,h.options,s),null===(d=h.parent)||void 0===d||d.bubble("reflow"),this}ctrlDeleteDir(t){var e,n,i,r,o,a,c,d;l(t);const h=this.cursor;return!h[t]||h.selection?this.deleteDir(t):(this.notify("edit"),t===s?new b(null===(e=h.parent)||void 0===e?void 0:e.ends[s],h[s]).remove():new b(h[1],null===(n=h.parent)||void 0===n?void 0:n.ends[1]).remove(),h.insAtDirEnd(t,h.parent),null===(i=h[1])||void 0===i||i.postOrder("contactWeld",h),null===(o=null===(r=h[s])||void 0===r?void 0:r.siblingDeleted)||void 0===o||o.call(r,h.options,1),null===(c=null===(a=h[1])||void 0===a?void 0:a.siblingDeleted)||void 0===c||c.call(a,h.options,s),null===(d=h.parent)||void 0===d||d.bubble("reflow"),this)}backspace(){return this.deleteDir(s)}deleteForward(){return this.deleteDir(1)}selectDir(t){var e,n;const i=this.notify("select").cursor,r=i.selection;l(t),i.anticursor||i.startSelection();const o=i[t];o?r&&(null==r?void 0:r.ends[t])===o&&(null===(e=i.anticursor)||void 0===e?void 0:e[t===s?1:s])!==o?o.unselectInto(t,i):o.selectTowards(t,i):null===(n=i.parent)||void 0===n||n.selectOutOf(t,i),i.clearSelection(),i.select()||i.show()}selectLeft(){return this.selectDir(s)}selectRight(){return this.selectDir(1)}}class it{constructor(t){this.__controller=t,this.__controller.apiClass=this,this.__options=t.options,this.id=t.id}__mathquillify(...t){const s=this.__controller.root,n=this.__controller.container;this.__controller.createTextarea(),n.classList.add(...t);const i=Array.from(n.childNodes).map((t=>n.removeChild(t))),r=document.createElement("span");r.classList.add("mq-root-block"),r.setAttribute(e,s.id.toString()),s.elements.add(r),n.append(r),this.latex(i.reduce(((t,e)=>{var s;return 8===e.nodeType?t:`${t}${null!==(s=e.textContent)&&void 0!==s?s:""}`}),"")),this.revert=()=>{for(;n.firstChild;)n.firstChild.remove();return n.classList.remove("mq-editable-field","mq-math-mode","mq-text-mode"),this.__controller.mouseDownHandler&&n.removeEventListener("mousedown",this.__controller.mouseDownHandler),n.append(...i),n}}config(t){return v.config(this.__options,t),this}el(){return this.__controller.container}text(){return this.__controller.exportText()}latex(t){var e;return void 0!==t?(this.__controller.renderLatexMath(t),this.__controller.blurred&&(null===(e=this.__controller.cursor.hide().parent)||void 0===e||e.blur()),this):this.__controller.exportLatex()}html(){return this.__controller.root.elements.html().replace(new RegExp(` (?:${e}|${t})="?\\d+"?`,"g"),"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")}reflow(){return this.__controller.root.postOrder("reflow"),this}}class rt extends it{__mathquillify(...t){return super.__mathquillify(...t),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this}focus(){var t,e;return document.activeElement===this.__controller.textarea?null===(t=this.__controller.textarea)||void 0===t||t.dispatchEvent(new FocusEvent("focus")):null===(e=this.__controller.textarea)||void 0===e||e.focus(),this}blur(){var t,e;return document.activeElement!==this.__controller.textarea?null===(t=this.__controller.textarea)||void 0===t||t.dispatchEvent(new FocusEvent("blur")):null===(e=this.__controller.textarea)||void 0===e||e.blur(),this}write(t){var e;return this.__controller.writeLatex(t),this.__controller.scrollHoriz(),this.__controller.blurred&&(null===(e=this.__controller.cursor.hide().parent)||void 0===e||e.blur()),this}empty(){const t=this.__controller.root,e=this.__controller.cursor;return t.eachChild("postOrder","dispose"),delete t.ends[s],delete t.ends[1],t.elements.empty(),delete e.selection,e.insAtRightEnd(t),this}cmd(t){var e,s;const n=this.__controller.notify(),i=n.cursor;if(/^\\[a-z]+$/i.test(t)&&!i.isTooDeep()){t=t.slice(1);const e=c[t];if(e){const s=new e(t);i.selection&&s.replaces(i.replaceSelection()),s.createLeftOf(i.show()),this.__controller.scrollHoriz()}}else null===(e=i.parent)||void 0===e||e.write(i,t);return n.blurred&&(null===(s=i.hide().parent)||void 0===s||s.blur()),this}select(){const t=this.__controller;for(t.notify("move").cursor.insAtRightEnd(t.root);t.cursor[s];)t.selectLeft();return this}clearSelection(){return this.__controller.cursor.clearSelection(),this}moveToDirEnd(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this}moveToLeftEnd(){return this.moveToDirEnd(s)}moveToRightEnd(){return this.moveToDirEnd(1)}keystroke(t){const e=t.replace(/^\s+|\s+$/g,"").split(/\s+/);for(const t of e){const e=new KeyboardEvent("noop");e.preventDefault=n,this.__controller.keystroke(t,e)}return this}typedText(t){for(const e of t)this.__controller.typedText(e);return this}dropEmbedded(t,e,s){const n=document.elementFromPoint(t-window.pageXOffset,e-window.pageYOffset);this.__controller.seek(n,t);(new c.embed).setOptions(s).createLeftOf(this.__controller.cursor)}clickAt(t,e,s){s=s||document.elementFromPoint(t,e);const n=this.__controller,i=n.root;return i.elements.firstElement.contains(s)||(s=i.elements.firstElement),n.seek(s,t+window.pageXOffset),n.blurred&&this.focus(),this}ignoreNextMousedown(t){return this.__controller.cursor.options.ignoreNextMousedown=t,this}}class ot{push(t){this[Object.keys(this).length]=t}get length(){return Object.keys(this).length}get(t){for(const e of Object.keys(this)){const s=parseInt(e);if(this[s].name===t)return this[s]}}}class lt extends it{constructor(t){super(t),this.__controller.root.postOrder("registerInnerField",this.innerFields=new ot,ct)}__mathquillify(){return super.__mathquillify("mq-math-mode"),this.__options.mouseEvents&&(this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents()),this}latex(t){const e=super.latex(t);return void 0!==t&&this.__controller.root.postOrder("registerInnerField",this.innerFields=new ot,ct),e}}lt.RootBlock=Q;class at extends rt{__mathquillify(){const t=this.__controller.root.reflow;return this.__controller.root.reflow=n,super.__mathquillify("mq-editable-field","mq-math-mode"),t?this.__controller.root.reflow=t:delete this.__controller.root.reflow,this}}at.RootBlock=G;class ct extends at{constructor(){super(...arguments),this.name=""}makeStatic(){this.__controller.editable=!1,this.__controller.root.blur(),this.__controller.unbindEditablesEvents(),this.__controller.container.classList.remove("mq-editable-field")}makeEditable(){this.__controller.editable=!0,this.__controller.editablesTextareaEvents(),this.__controller.cursor.insAtRightEnd(this.__controller.root),this.__controller.container.classList.add("mq-editable-field")}}class dt extends rt{__mathquillify(){return super.__mathquillify("mq-editable-field","mq-text-mode")}latex(t){var e;return void 0!==t?(this.__controller.renderLatexText(t),this.__controller.blurred&&(null===(e=this.__controller.cursor.hide().parent)||void 0===e||e.blur()),this):this.__controller.exportLatex()}}dt.RootBlock=class extends G{keystroke(t,e,s){if("Spacebar"!==t&&"Shift-Spacebar"!==t)return super.keystroke(t,e,s)}write(t,e){t.show().deleteSelection(),"$"===e?new K(t).createLeftOf(t):new A(e,"<"===e?"&lt;":">"===e?"&gt;":void 0).createLeftOf(t)}};class ht extends D{constructor(t,e,s){super(t,`<${e} ${s}>&0</${e}>`)}}c.mathrm=r(ht,"\\mathrm","span",'class="mq-roman mq-font"'),c.mathit=r(ht,"\\mathit","i",'class="mq-font"'),c.mathbf=r(ht,"\\mathbf","b",'class="mq-font"'),c.mathsf=r(ht,"\\mathsf","span",'class="mq-sans-serif mq-font"'),c.mathtt=r(ht,"\\mathtt","span",'class="mq-monospace mq-font"'),c.underline=r(ht,"\\underline","span",'class="mq-non-leaf mq-underline"'),c.overline=c.bar=r(ht,"\\overline","span",'class="mq-non-leaf mq-overline"'),c.overrightarrow=r(ht,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),c.overleftarrow=r(ht,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"'),c.overleftrightarrow=r(ht,"\\overleftrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-both"'),c.overarc=r(ht,"\\overarc","span",'class="mq-non-leaf mq-overarc"'),c.dot=class extends D{constructor(){super("\\dot",'<span class="mq-non-leaf"><span class="mq-dot-recurring-inner"><span class="mq-dot-recurring">&#x2d9;</span><span class="mq-empty-box">&0</span></span></span>')}},c.textcolor=class extends D{setColor(t){this.color=t,this.htmlTemplate=`<span class="mq-textcolor" style="color:${t}">&0</span>`}latex(){var t;return`\\textcolor{${null!==(t=this.color)&&void 0!==t?t:""}}{${this.blocks[0].latex()}}`}parser(){return k.optWhitespace.then(k.string("{")).then(k.regex(/^[#\w\s.,()%-]*/)).skip(k.string("}")).then((t=>(this.setColor(t),super.parser())))}isStyleBlock(){return!0}},c.class=class extends D{parser(){return k.optWhitespace.then(k.string("{")).then(k.regex(/^[-\w\s\\\xA0-\xFF]*/)).skip(k.string("}")).then((t=>(this.cls=t||"",this.htmlTemplate=`<span class="mq-class ${t}">&0</span>`,super.parser())))}latex(){var t;return`\\class{${null!==(t=this.cls)&&void 0!==t?t:""}}{${this.blocks[0].latex()}}`}isStyleBlock(){return!0}},c.subscript=c._=class extends P{constructor(){super(),this.supsub="sub",this.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',this.textTemplate=["_"]}finalizeTree(){this.downInto=this.sub=this.ends[s],this.sub.upOutOf=F,super.finalizeTree()}},c.superscript=c.supscript=c["^"]=class extends P{constructor(){super(),this.supsub="sup",this.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',this.textTemplate=["^(",")"]}finalizeTree(){this.upInto=this.sup=this.ends[1],this.sup.downOutOf=F,super.finalizeTree()}};class ut extends H{constructor(t,e){super(t,`<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>${e}</big><span class="mq-from"><span>&0</span></span></span>`,[t.length>1?t.slice(1):t])}createLeftOf(t){super.createLeftOf(t),t.options.sumStartsWithNEquals&&!this.replacedFragment&&(new M("n").createLeftOf(t),(new B).createLeftOf(t))}}c["∑"]=c.sum=c.summation=r(ut,"\\sum ","&sum;"),c["∏"]=c.prod=c.product=r(ut,"\\prod ","&prod;"),c.coprod=c.coproduct=r(ut,"\\coprod ","&#8720;"),c["∫"]=c.int=c.integral=class extends H{constructor(){super("\\int ",'<span class="mq-int mq-non-leaf"><big>&int;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')}},c.frac=c.dfrac=c.cfrac=c.fraction=W;const pt=t=>class extends t{createLeftOf(t){var e,n,i;if(!this.replacedFragment){let r=t[s];for(;r&&!(r instanceof R||"text"in c&&r instanceof c.text||r instanceof H||"\\ "===r.ctrlSeq||/^[,;:]$/.test(r.ctrlSeq));)r=r[s];r instanceof H&&r[1]instanceof P&&(r=r[1],r&&r[1]instanceof P&&(null===(e=r[1])||void 0===e?void 0:e.ctrlSeq)!=r.ctrlSeq&&(r=r[1])),r===t[s]||t.isTooDeep(1)||(null===(n=t[s])||void 0===n?void 0:n.elements.hasClass("mq-operator-name"))||(this.replaces(new b((null==r?void 0:r[1])||(null===(i=t.parent)||void 0===i?void 0:i.ends[s]),t[s])),t[s]=r)}super.createLeftOf(t)}};c.over=d["/"]=class extends(pt(W)){};class mt extends D{constructor(){super(),this.ctrlSeq="\\sqrt",this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',this.textTemplate=["sqrt(",")"],this.reflow=()=>{var t;const e=null===(t=this.ends[1])||void 0===t?void 0:t.elements.firstElement;e&&S([e.previousElementSibling],1,e.getBoundingClientRect().height/parseFloat(getComputedStyle(e).fontSize)-.1)}}parser(){return j.optBlock.then((t=>j.block.map((e=>{const s=new ft;return s.blocks=[t,e],t.adopt(s),e.adopt(s,t),s})))).or(super.parser())}}c.sqrt=c["√"]=mt,c.hat=class extends D{constructor(){super("\\hat",'<span class="mq-non-leaf"><span class="mq-hat-prefix">^</span><span class="mq-hat-stem">&0</span></span>',["hat(",")"])}};class ft extends mt{constructor(){super(),this.htmlTemplate='<span class="mq-nthroot mq-non-leaf">&0</span><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',this.textTemplate=["root(",",",")"]}latex(){var t,e,n,i;return`\\sqrt[${null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.latex())&&void 0!==e?e:""}]{${null!==(i=null===(n=this.ends[1])||void 0===n?void 0:n.latex())&&void 0!==i?i:""}}`}text(){var t,e,n,i,r,o,l,a;const c=null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.text())&&void 0!==e?e:"";if(""===c||"2"===c)return`sqrt(${null!==(i=null===(n=this.ends[1])||void 0===n?void 0:n.text())&&void 0!==i?i:""})`;if(function t(e){return e.controller?e.controller:t(e.parent)}(this).options.rootsAreExponents){const t=this[1]instanceof P&&"sup"===this[1].supsub;return`${t?"(":""}(${null!==(o=null===(r=this.ends[1])||void 0===r?void 0:r.text())&&void 0!==o?o:""})^(1/${c})${t?")":""}`}return`root(${c},${null!==(a=null===(l=this.ends[1])||void 0===l?void 0:l.text())&&void 0!==a?a:""})`}}c.root=c.nthroot=ft;class vt extends D{constructor(t,e,s){super(t,`<span class="mq-non-leaf"><span class="mq-diacritic-above">${e}</span><span class="mq-diacritic-stem">&0</span></span>`,s)}}c.vec=r(vt,"\\vec","&rarr;",["vec(",")"]),c.tilde=r(vt,"\\tilde","~",["tilde(",")"]);const gt=(t,e)=>{const n=e||t,i=h[t],o=h[n];d[t]=r(U,s,t,i,n,o),d[i]=r(U,1,t,i,n,o)};gt("("),gt("["),gt("{","\\{"),c.langle=r(U,s,"&lang;","&rang;","\\langle ","\\rangle "),c.rangle=r(U,1,"&lang;","&rang;","\\langle ","\\rangle "),c.abs=d["|"]=r(U,s,"|","|","|","|"),c.lVert=r(U,s,"&#8741;","&#8741;","\\lVert ","\\rVert "),c.rVert=r(U,1,"&#8741;","&#8741;","\\lVert ","\\rVert "),c.left=class extends D{parser(){return k.optWhitespace.then(k.regex(/^(?:[([|]|\\\{|\\langle(?![a-zA-Z])|\\lVert(?![a-zA-Z]))/)).then((t=>{let e="\\"===t.charAt(0)?t.slice(1):t;return"\\langle"==t&&(e="&lang;",t+=" "),"\\lVert"==t&&(e="&#8741;",t+=" "),j.then((s=>k.string("\\right").skip(k.optWhitespace).then(k.regex(/^(?:[\])|]|\\\}|\\rangle(?![a-zA-Z])|\\rVert(?![a-zA-Z]))/)).map((n=>{let i="\\"===n.charAt(0)?n.slice(1):n;"\\rangle"==n&&(i="&rang;",n=`${n} `),"\\rVert"==n&&(i="&#8741;",n=`${n} `);const r=new U(0,e,i,t,n);return r.blocks=[s],s.adopt(r),r}))))}))}},c.right=class extends D{parser(){return k.fail("unmatched \\right")}};class bt extends(_(D)){constructor(){super("\\binom",'<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',["choose(",",",")"])}}c.binom=c.binomial=bt,c.choose=class extends(pt(bt)){},c.editable=c.MathQuillMathField=class extends D{constructor(){super("\\MathQuillMathField",'<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>'),this.name=""}parser(){return k.string("[").then(k.regex(/^[a-z][a-z0-9]*/i)).skip(k.string("]")).map((t=>this.name=t)).or(k.succeed()).then(super.parser())}finalizeTree(t){const e=new nt(this.ends[s],this.elements.firstElement,t);e.KIND_OF_MQ="MathField",this.field=new ct(e),this.field.name=this.name,e.editable=!0,e.createTextarea(),e.editablesTextareaEvents(),e.cursor.insAtRightEnd(e.root),E(e.root),this.field.blur()}registerInnerField(t){t.push(this.field)}latex(){var t,e;return null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.latex())&&void 0!==e?e:""}text(){var t,e;return null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.text())&&void 0!==e?e:""}},c.embed=class extends ${setOptions(t){const e=()=>"";return this.text=t.text||e,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||e,this}parser(){return k.string("{").then(k.regex(/^[a-z][a-z0-9]*/i)).skip(k.string("}")).then((t=>k.string("[").then(k.regex(/^[-\w\s]*/)).skip(k.string("]")).or(k.succeed()).map((e=>this.setOptions(u[t](e))))))}};class xt extends(T(y(q))){constructor(){super(),this.anticursorPosition=0,this.ctrlSeq="\\text"}replaces(t){t instanceof b?this.replacedText=t.remove().elements.text():"string"==typeof t&&(this.replacedText=t)}addToElements(t){var e;super.addToElements(t),null===(e=this.ends[s])||void 0===e||e.addToElements(this.elements.first.firstChild)}createLeftOf(t){var e,n,i,r;if(super.createLeftOf(t),t.insAtRightEnd(this),this.replacedText)for(const e of this.replacedText)this.write(t,e);null===(n=null===(e=this[1])||void 0===e?void 0:e.siblingCreated)||void 0===n||n.call(e,t.options,s),null===(r=null===(i=this[s])||void 0===i?void 0:i.siblingCreated)||void 0===r||r.call(i,t.options,1),this.bubble("reflow")}parser(){return k.optWhitespace.then(k.string("{")).then(k.regex(/^(\\}|[^}])*/)).skip(k.string("}")).map((t=>0===t.length?new b:(new wt(t.replace(/\\{/g,"{").replace(/\\}/g,"}")).adopt(this),this)))}textContents(){return this.foldChildren("",((t,e)=>t+e.text()))}text(){return this.textContents()}latex(){const t=this.textContents();return 0===t.length?"":"\\text{"+t.replace(/[{}]/g,"\\$&")+"}"}html(){return`<span class="mq-text-mode" ${t}=${this.id}>${this.textContents()}</span>`}moveTowards(t,e){e.insAtDirEnd(t===s?1:s,this)}moveOutOf(t,e){e.insDirOf(t,this)}unselectInto(t,e){e.insAtDirEnd(t===s?1:s,this);const n=e[t].splitRight(this.anticursorPosition);t===s&&(e[s]=n),e.anticursor=new O(this,n[s],n),e.anticursor.ancestors={};for(let t=e.anticursor;t.parent;t=t.parent)e.anticursor.ancestors[t.parent.id]=t}selectOutOf(t,e){var n,i,r,o,l,a;this.anticursorPosition=t===s?(null!==(r=null===(i=null===(n=e.selection)||void 0===n?void 0:n.elements.first.textContent)||void 0===i?void 0:i.length)&&void 0!==r?r:1)-1:this.textContents().length-(null!==(a=null===(l=null===(o=e.selection)||void 0===o?void 0:o.elements.first.textContent)||void 0===l?void 0:l.length)&&void 0!==a?a:1)+1,e.insDirOf(t,this)}deleteOutOf(t,e){this.isEmpty()&&e.insRightOf(this)}write(t,e){if(t.show().deleteSelection(),"$"!==e)this.postOrder("reflow"),t[s]?t[s].appendText(e):new wt(e).createLeftOf(t),this.bubble("reflow");else if(this.isEmpty())t.insRightOf(this),new A("\\$","$").createLeftOf(t);else if(t[1])if(t[s]){const e=new xt,n=this.ends[s];n.disown().elements.detach(),n.adopt(e),t.insLeftOf(this),super.createLeftOf.call(e,t)}else t.insLeftOf(this);else t.insRightOf(this);this.bubble("reflow")}writeLatex(t,e){t[s]?t[s].appendText(e):new wt(e).createLeftOf(t),this.bubble("reflow")}seek(t,e){var n,i,r,o,l,a;e.hide();const c=this.fuseChildren(),d=getComputedStyle(this.elements.firstElement),h=(this.elements.firstElement.getBoundingClientRect().width-parseFloat(d.paddingLeft)-parseFloat(d.paddingRight))/this.text().length,u=Math.round((t-this.elements.firstElement.getBoundingClientRect().left)/h);u<=0?e.insAtLeftEnd(this):u>=c.text().length?e.insAtRightEnd(this):e.insLeftOf(c.splitRight(u));let p=t-e.show().offset().left;const m=p&&p<0?s:1;let f=m;for(;e[m]&&p*f>0;)null===(n=e[m])||void 0===n||n.moveTowards(m,e),f=p,p=t-e.offset().left;if(m*p<-m*f&&(null===(i=e[m===s?1:s])||void 0===i||i.moveTowards(m===s?1:s,e)),e.anticursor){if(e.anticursor.parent===this){const t=null!==(a=e[s]&&(null===(l=e[s])||void 0===l?void 0:l.text().length))&&void 0!==a?a:0;if(this.anticursorPosition===t)e.startSelection();else{let n;this.anticursorPosition<t?(n=e[s].splitRight(this.anticursorPosition),e[s]=n):n=e[1].splitRight(this.anticursorPosition-t),e.anticursor=new O(this,n[s],n),e.anticursor.ancestors={};for(let t=e.anticursor;t.parent;t=t.parent)e.anticursor.ancestors[t.parent.id]=t}}}else this.anticursorPosition=null!==(o=e[s]&&(null===(r=e[s])||void 0===r?void 0:r.text().length))&&void 0!==o?o:0}blur(t){super.blur(),t&&(""===this.textContents()?(this.remove(),t[s]===this?t[s]=this[s]:t[1]===this&&(t[1]=this[1])):(this.elements.find(".mq-selection").contents.length&&t.clearSelection(),this.fuseChildren()),function t(e){return(null==e?void 0:e.controller)?null==e?void 0:e.controller:t(null==e?void 0:e.parent)}(t.parent).handle("textBlockExit"))}fuseChildren(){this.elements.first.normalize();const t=this.elements.first.firstChild;if(!t)return;o("only node in TextBlock span is Text node",3===t.nodeType);const e=new wt(t.data);return e.addToElements(t),this.children().disown(),e.adopt(this)}focus(){super.focus(),function t(e){return(null==e?void 0:e.controller)?null==e?void 0:e.controller:t(null==e?void 0:e.parent)}(this).handle("textBlockEnter")}}class wt extends q{constructor(t){super(),this.textStr=t}text(){return this.textStr}addToElements(t){this.dom=t,this.elements=new g(t)}domify(){return this.addToElements(document.createTextNode(this.textStr)),this.elements}appendText(t){var e;this.textStr+=t,null===(e=this.dom)||void 0===e||e.appendData(t)}prependText(t){var e;this.textStr=t+this.textStr,null===(e=this.dom)||void 0===e||e.insertData(0,t)}insTextAtDirEnd(t,e){l(e),1===e?this.appendText(t):this.prependText(t)}splitRight(t){var e;const s=new wt(this.textStr.slice(t)).adopt(this.parent,this,this[1]);return s.addToElements(null===(e=this.dom)||void 0===e?void 0:e.splitText(t)),this.textStr=this.textStr.slice(0,t),s}endChar(t,e){return e.charAt(t===s?0:-1+e.length)}moveTowards(t,e){l(t);const n=this.endChar(t===s?1:s,this.textStr),i=this[t===s?1:s];return i?i.insTextAtDirEnd(n,t):new wt(n).createDir(t===s?1:s,e),this.deleteTowards(t,e)}latex(){return this.textStr}deleteTowards(t,e){var s,n;this.textStr.length>1?1===t?(null===(s=this.dom)||void 0===s||s.deleteData(0,1),this.textStr=this.textStr.slice(1)):(null===(n=this.dom)||void 0===n||n.deleteData(-1+this.textStr.length,1),this.textStr=this.textStr.slice(0,-1)):(this.remove(),this.elements.remove(),e[t]=this[t])}selectTowards(t,e){l(t);const n=e.anticursor,i=this.endChar(t===s?1:s,this.textStr);if((null==n?void 0:n[t])===this){const s=new wt(i).createDir(t,e);n[t]=s,e.insDirOf(t,s)}else{const r=this[t===s?1:s];if(r)r.insTextAtDirEnd(i,t);else{const n=new wt(i).createDir(t===s?1:s,e);e.selection&&n.elements.insDirOf(t===s?1:s,e.selection.elements)}1===this.textStr.length&&(null==n?void 0:n[t===s?1:s])===this&&(n[t===s?1:s]=this[t===s?1:s])}return this.deleteTowards(t,e)}}c.text=c.textnormal=c.textrm=c.textup=d['"']=c.textmd=xt;const qt=(t,e,s)=>class extends xt{constructor(){super(),this.ctrlSeq=t,this.htmlTemplate=`<${e} ${s}>&0</${e}>`}};c.em=c.italic=c.italics=c.emph=c.textit=c.textsl=qt("\\textit","i",'class="mq-text-mode"'),c.strong=c.bold=c.textbf=qt("\\textbf","b",'class="mq-text-mode"'),c.sf=c.textsf=qt("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),c.tt=c.texttt=qt("\\texttt","span",'class="mq-monospace mq-text-mode"'),c.textsc=qt("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),c.uppercase=qt("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),c.lowercase=qt("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"'),d["\\"]=class extends D{constructor(){super(),this.ctrlSeq="\\",this.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',this.textTemplate=["\\"]}replaces(t){this._replacedFragment=null==t?void 0:t.disown(),this.isEmpty=()=>!1}createBlocks(){super.createBlocks();const t=this.ends[s];t.focus=()=>{var e,s;return null===(e=t.parent)||void 0===e||e.elements.addClass("mq-hasCursor"),t.isEmpty()&&(null===(s=t.parent)||void 0===s||s.elements.removeClass("mq-empty")),t},t.blur=()=>{var e,s;return null===(e=t.parent)||void 0===e||e.elements.removeClass("mq-hasCursor"),t.isEmpty()&&(null===(s=t.parent)||void 0===s||s.elements.addClass("mq-empty")),t},t.write=(e,s)=>{var n;e.show().deleteSelection(),s.match(/[a-z]/i)?new A(s).createLeftOf(e):(t.parent.renderCommand(e),"\\"===s&&t.isEmpty()||null===(n=e.parent)||void 0===n||n.write(e,s))},t.keystroke=(e,s,n)=>"Tab"===e||"Enter"===e||"Spacebar"===e?(t.parent.renderCommand(n.cursor),void s.preventDefault()):super.keystroke(e,s,n)}createLeftOf(t){if(super.createLeftOf(t),this._replacedFragment){const t=this.elements.first;this._replacedFragment.elements.addClass("mq-blur"),this.elements.first.before(...this._replacedFragment.elements.contents),this.elements.add(this._replacedFragment.elements);const e=e=>{e.stopPropagation(),e.preventDefault(),t.dispatchEvent(new MouseEvent(e.type,e))};this.elements.firstElement.addEventListener("mousedown",e),this.elements.firstElement.addEventListener("mousemove",e)}}latex(){var t,e;return"\\"+(null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.latex())&&void 0!==e?e:"")+" "}renderCommand(t){var e;this.elements=new g(this.elements.last),this.remove(),this[1]?t.insLeftOf(this[1]):t.insAtRightEnd(this.parent);const n=(null===(e=this.ends[s])||void 0===e?void 0:e.latex())||" ";if(n in c){const e=new c[n](n);this._replacedFragment&&e.replaces(this._replacedFragment),e.createLeftOf(t)}else{const e=new xt;e.replaces(n),e.createLeftOf(t),t.insRightOf(e),this._replacedFragment&&this._replacedFragment.remove()}}};class Ot extends ${constructor(t){super(),this.ctrlSeq=t}createLeftOf(t){for(const e of this.ctrlSeq)new M(e).createLeftOf(t)}parser(){const t=new Q;for(const e of this.ctrlSeq)new M(e).adopt(t,t.ends[1]);return k.succeed(t.children())}}for(const t in v.autoOperatorNames)"_maxLength"!==t&&(c[t]=Ot);c.operatorname=class extends D{constructor(t,e,s){super(t,e,s),this.createLeftOf=n}numBlocks(){return 1}parser(){return j.block.map((t=>t.children()))}},c.f=class extends M{constructor(){super("f",'<var class="mq-f">f</var>'),this.letter="f"}italicize(t){return this.elements.html("f"),this.elements.toggleClass("mq-f",t),super.italicize(t)}},c[" "]=c.space=r(A,"\\ ","&nbsp;"),c["'"]=c.prime=r(A,"'","&prime;"),c.backslash=r(A,"\\backslash ","\\"),d["\\"]||(d["\\"]=c.backslash),c.$=r(A,"\\$","$");class Et extends ${constructor(t,e){super(t,`<span class="mq-nonSymbola">${e||t}</span>`)}}c["@"]=Et,c["&"]=r(Et,"\\&","&amp;"),c["%"]=r(Et,"\\%","%"),c.alpha=c.beta=c.gamma=c.delta=c.zeta=c.eta=c.theta=c.iota=c.kappa=c.mu=c.nu=c.xi=c.rho=c.sigma=c.tau=c.chi=c.psi=c.omega=class extends Et{constructor(t){super(`\\${t} `,`&${t};`)}},c.phi=r(Et,"\\phi ","&#981;"),c.phiv=c.varphi=r(z,"\\varphi ","&phi;"),c.epsilon=r(Et,"\\epsilon ","&#1013;"),c.epsiv=c.varepsilon=r(z,"\\varepsilon ","&epsilon;"),c.piv=c.varpi=r(z,"\\varpi ","&piv;"),c.sigmaf=c.sigmav=c.varsigma=r(z,"\\varsigma ","&sigmaf;"),c.thetav=c.vartheta=c.thetasym=r(z,"\\vartheta ","&thetasym;"),c.upsilon=c.upsi=r(z,"\\upsilon ","&upsilon;"),c.gammad=c.Gammad=c.digamma=r(z,"\\digamma ","&#989;"),c.kappav=c.varkappa=r(z,"\\varkappa ","&#1008;"),c.rhov=c.varrho=r(z,"\\varrho ","&#1009;"),c.pi=c["π"]=r(Et,"\\pi ","&pi;"),c.lambda=r(Et,"\\lambda ","&lambda;"),c.Upsilon=c.Upsi=c.upsih=c.Upsih=r($,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),c.Gamma=c.Delta=c.Theta=c.Lambda=c.Xi=c.Pi=c.Sigma=c.Phi=c.Psi=c.Omega=c.forall=class extends A{constructor(t){super(`\\${t} `,`&${t};`)}};class yt extends D{constructor(t){super(),this.latex=()=>t}createLeftOf(t){var e,n,i,r,o,l,a;const c=j.parse(this.latex());c.children().adopt(t.parent,t[s],t[1]),t[s]=c.ends[1],t.element.before(...c.domify().contents),c.finalizeInsert(t.options,t),null===(i=null===(n=null===(e=c.ends[1])||void 0===e?void 0:e[1])||void 0===n?void 0:n.siblingCreated)||void 0===i||i.call(n,t.options,s),null===(l=null===(o=null===(r=c.ends[s])||void 0===r?void 0:r[s])||void 0===o?void 0:o.siblingCreated)||void 0===l||l.call(o,t.options,1),null===(a=t.parent)||void 0===a||a.bubble("reflow")}parser(){const t=j.parse(this.latex());return k.succeed(t.children())}}c["¹"]=r(yt,"^1"),c["²"]=r(yt,"^2"),c["³"]=r(yt,"^3"),c["¼"]=r(yt,"\\frac14"),c["½"]=r(yt,"\\frac12"),c["¾"]=r(yt,"\\frac34");class St extends R{constructor(t,e,s){super(t,`<span>${e||t}</span>`,s,!0),this.siblingCreated=this.siblingDeleted=(t,e)=>this.contactWeld(t,e)}contactWeld(t,e){const n=t=>t[s]?!!(t[s]instanceof R||/^[,;:([]$/.test(t[s].ctrlSeq)):!(t.parent&&t.parent.parent&&t.parent.parent.isStyleBlock())||n(t.parent.parent);if(1!==e)return this.isUnary=n(this),this.elements.firstElement.className=this.isUnary?"":"mq-binary-operator",this}}c["+"]=r(St,"+","+"),c["–"]=c["-"]=r(St,"-","&minus;"),c["±"]=c.pm=c.plusmn=c.plusminus=r(St,"\\pm ","&plusmn;"),c.mp=c.mnplus=c.minusplus=r(St,"\\mp ","&#8723;"),d["*"]=c.sdot=c.cdot=r(R,"\\cdot ","&middot;","*");const _t={ctrlSeq:"\\le ",html:"&le;",text:"<=",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},kt={ctrlSeq:"\\ge ",html:"&ge;",text:">=",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"};c["<"]=c.lt=r(I,_t,!0),c[">"]=c.gt=r(I,kt,!0),c["≤"]=c.le=c.leq=r(I,_t,!1),c["≥"]=c.ge=c.geq=r(I,kt,!1),c["="]=B,c["×"]=c.times=r(R,"\\times ","&times;","*"),c["÷"]=c.div=c.divide=c.divides=r(R,"\\div ","&divide;","/"),d["~"]=c.sim=r(R,"\\sim ","~","~"),c.notin=c.cong=c.equiv=c.oplus=c.otimes=class extends R{constructor(t){super(`\\${t} `,`&${t};`)}},c["≠"]=c.ne=c.neq=r(R,"\\ne ","&ne;"),c["∗"]=c.ast=c.star=c.loast=c.lowast=r(R,"\\ast ","&lowast;"),c.therefor=c.therefore=r(R,"\\therefore ","&there4;"),c.cuz=c.because=r(R,"\\because ","&#8757;"),c.prop=c.propto=r(R,"\\propto ","&prop;"),c["≈"]=c.asymp=c.approx=r(R,"\\approx ","&asymp;"),c.isin=c.in=r(R,"\\in ","&isin;"),c.ni=c.contains=r(R,"\\ni ","&ni;"),c.notni=c.niton=c.notcontains=c.doesnotcontain=r(R,"\\not\\ni ","&#8716;"),c.sub=c.subset=r(R,"\\subset ","&sub;"),c.sup=c.supset=c.superset=r(R,"\\supset ","&sup;"),c.nsub=c.notsub=c.nsubset=c.notsubset=r(R,"\\not\\subset ","&#8836;"),c.nsup=c.notsup=c.nsupset=c.notsupset=c.nsuperset=c.notsuperset=r(R,"\\not\\supset ","&#8837;"),c.sube=c.subeq=c.subsete=c.subseteq=r(R,"\\subseteq ","&sube;"),c.supe=c.supeq=c.supsete=c.supseteq=c.supersete=c.superseteq=r(R,"\\supseteq ","&supe;"),c.nsube=c.nsubeq=c.notsube=c.notsubeq=c.nsubsete=c.nsubseteq=c.notsubsete=c.notsubseteq=r(R,"\\not\\subseteq ","&#8840;"),c.nsupe=c.nsupeq=c.notsupe=c.notsupeq=c.nsupsete=c.nsupseteq=c.notsupsete=c.notsupseteq=c.nsupersete=c.nsuperseteq=c.notsupersete=c.notsuperseteq=r(R,"\\not\\supseteq ","&#8841;"),c.mathbb=class extends D{constructor(t,e,s){super(t,e,s),this.createLeftOf=n}numBlocks(){return 1}parser(){return k.optWhitespace.then(k.string("{")).then(k.optWhitespace).then(k.regex(/^[NPZQRCH]/)).skip(k.optWhitespace).skip(k.string("}")).map((t=>new c[t]))}},c.N=c.naturals=c.Naturals=r(A,"\\mathbb{N}","&#8469;"),c.P=c.primes=c.Primes=c.projective=c.Projective=c.probability=c.Probability=r(A,"\\mathbb{P}","&#8473;"),c.Z=c.integers=c.Integers=r(A,"\\mathbb{Z}","&#8484;"),c.Q=c.rationals=c.Rationals=r(A,"\\mathbb{Q}","&#8474;"),c.R=c.reals=c.Reals=r(A,"\\mathbb{R}","&#8477;"),c.C=c.complex=c.Complex=c.complexes=c.Complexes=c.complexplane=c.Complexplane=c.ComplexPlane=r(A,"\\mathbb{C}","&#8450;"),c.H=c.Hamiltonian=c.quaternions=c.Quaternions=r(A,"\\mathbb{H}","&#8461;"),c.quad=c.emsp=r(A,"\\quad ","    "),c.qquad=r(A,"\\qquad ","        "),c.diamond=r(A,"\\diamond ","&#9671;"),c.bigtriangleup=r(A,"\\bigtriangleup ","&#9651;"),c.ominus=r(A,"\\ominus ","&#8854;"),c.uplus=r(A,"\\uplus ","&#8846;"),c.bigtriangledown=r(A,"\\bigtriangledown ","&#9661;"),c.sqcap=r(A,"\\sqcap ","&#8851;"),c.triangleleft=r(A,"\\triangleleft ","&#8882;"),c.sqcup=r(A,"\\sqcup ","&#8852;"),c.triangleright=r(A,"\\triangleright ","&#8883;"),c.odot=c.circledot=r(A,"\\odot ","&#8857;"),c.bigcirc=r(A,"\\bigcirc ","&#9711;"),c.dagger=r(A,"\\dagger ","&#0134;"),c.ddagger=r(A,"\\ddagger ","&#135;"),c.wr=r(A,"\\wr ","&#8768;"),c.amalg=r(A,"\\amalg ","&#8720;"),c.models=r(A,"\\models ","&#8872;"),c.prec=r(A,"\\prec ","&#8826;"),c.succ=r(A,"\\succ ","&#8827;"),c.preceq=r(A,"\\preceq ","&#8828;"),c.succeq=r(A,"\\succeq ","&#8829;"),c.simeq=r(A,"\\simeq ","&#8771;"),c.mid=r(A,"\\mid ","&#8739;"),c.ll=r(A,"\\ll ","&#8810;"),c.gg=r(A,"\\gg ","&#8811;"),c.parallel=r(A,"\\parallel ","&#8741;"),c.nparallel=r(A,"\\nparallel ","&#8742;"),c.bowtie=r(A,"\\bowtie ","&#8904;"),c.sqsubset=r(A,"\\sqsubset ","&#8847;"),c.sqsupset=r(A,"\\sqsupset ","&#8848;"),c.smile=r(A,"\\smile ","&#8995;"),c.sqsubseteq=r(A,"\\sqsubseteq ","&#8849;"),c.sqsupseteq=r(A,"\\sqsupseteq ","&#8850;"),c.doteq=r(A,"\\doteq ","&#8784;"),c.frown=r(A,"\\frown ","&#8994;"),c.vdash=r(A,"\\vdash ","&#8870;"),c.dashv=r(A,"\\dashv ","&#8867;"),c.nless=r(A,"\\nless ","&#8814;"),c.ngtr=r(A,"\\ngtr ","&#8815;"),c.longleftarrow=r(A,"\\longleftarrow ","&#8592;"),c.longrightarrow=r(A,"\\longrightarrow ","&#8594;"),c.Longleftarrow=r(A,"\\Longleftarrow ","&#8656;"),c.Longrightarrow=r(A,"\\Longrightarrow ","&#8658;"),c.longleftrightarrow=r(A,"\\longleftrightarrow ","&#8596;"),c.updownarrow=r(A,"\\updownarrow ","&#8597;"),c.Longleftrightarrow=r(A,"\\Longleftrightarrow ","&#8660;"),c.Updownarrow=r(A,"\\Updownarrow ","&#8661;"),c.mapsto=r(A,"\\mapsto ","&#8614;"),c.nearrow=r(A,"\\nearrow ","&#8599;"),c.hookleftarrow=r(A,"\\hookleftarrow ","&#8617;"),c.hookrightarrow=r(A,"\\hookrightarrow ","&#8618;"),c.searrow=r(A,"\\searrow ","&#8600;"),c.leftharpoonup=r(A,"\\leftharpoonup ","&#8636;"),c.rightharpoonup=r(A,"\\rightharpoonup ","&#8640;"),c.swarrow=r(A,"\\swarrow ","&#8601;"),c.leftharpoondown=r(A,"\\leftharpoondown ","&#8637;"),c.rightharpoondown=r(A,"\\rightharpoondown ","&#8641;"),c.nwarrow=r(A,"\\nwarrow ","&#8598;"),c.ldots=r(A,"\\ldots ","&#8230;"),c.cdots=r(A,"\\cdots ","&#8943;"),c.vdots=r(A,"\\vdots ","&#8942;"),c.ddots=r(A,"\\ddots ","&#8945;"),c.surd=r(A,"\\surd ","&#8730;"),c.triangle=r(A,"\\triangle ","&#9651;"),c.ell=r(A,"\\ell ","&#8467;"),c.top=r(A,"\\top ","&#8868;"),c.flat=r(A,"\\flat ","&#9837;"),c.natural=r(A,"\\natural ","&#9838;"),c.sharp=r(A,"\\sharp ","&#9839;"),c.wp=r(A,"\\wp ","&#8472;"),c.bot=r(A,"\\bot ","&#8869;"),c.clubsuit=r(A,"\\clubsuit ","&#9827;"),c.diamondsuit=r(A,"\\diamondsuit ","&#9826;"),c.heartsuit=r(A,"\\heartsuit ","&#9825;"),c.spadesuit=r(A,"\\spadesuit ","&#9824;"),c.parallelogram=r(A,"\\parallelogram ","&#9649;"),c.square=r(A,"\\square ","&#11036;"),c.oint=r(A,"\\oint ","&#8750;"),c.bigcap=r(A,"\\bigcap ","&#8745;"),c.bigcup=r(A,"\\bigcup ","&#8746;"),c.bigsqcup=r(A,"\\bigsqcup ","&#8852;"),c.bigvee=r(A,"\\bigvee ","&#8744;"),c.bigwedge=r(A,"\\bigwedge ","&#8743;"),c.bigodot=r(A,"\\bigodot ","&#8857;"),c.bigotimes=r(A,"\\bigotimes ","&#8855;"),c.bigoplus=r(A,"\\bigoplus ","&#8853;"),c.biguplus=r(A,"\\biguplus ","&#8846;"),c.lfloor=r(A,"\\lfloor ","&#8970;"),c.rfloor=r(A,"\\rfloor ","&#8971;"),c.lceil=r(A,"\\lceil ","&#8968;"),c.rceil=r(A,"\\rceil ","&#8969;"),c.opencurlybrace=c.lbrace=r(A,"\\lbrace ","{"),c.closecurlybrace=c.rbrace=r(A,"\\rbrace ","}"),c.lbrack=r(A,"["),c.rbrack=r(A,"]"),c.slash=r(A,"/"),c.vert=r(A,"|"),c.perp=c.perpendicular=r(A,"\\perp ","&perp;"),c.nabla=c.del=r(A,"\\nabla ","&nabla;"),c.hbar=r(A,"\\hbar ","&#8463;"),c.AA=c.Angstrom=c.angstrom=r(A,"\\text\\AA ","&#8491;"),c.ring=c.circ=c.circle=r(A,"\\circ ","&#8728;"),c.bull=c.bullet=r(A,"\\bullet ","&bull;"),c.setminus=c.smallsetminus=r(A,"\\setminus ","&#8726;"),c.not=c["¬"]=c.neg=r(A,"\\neg ","&not;"),c["…"]=c.dots=c.ellip=c.hellip=c.ellipsis=c.hellipsis=r(A,"\\dots ","&hellip;"),c.converges=c.darr=c.dnarr=c.dnarrow=c.downarrow=r(A,"\\downarrow ","&darr;"),c.dArr=c.dnArr=c.dnArrow=c.Downarrow=r(A,"\\Downarrow ","&dArr;"),c.diverges=c.uarr=c.uparrow=r(A,"\\uparrow ","&uarr;"),c.uArr=c.Uparrow=r(A,"\\Uparrow ","&uArr;"),c.to=r(R,"\\to ","&rarr;"),c.rarr=c.rightarrow=r(A,"\\rightarrow ","&rarr;"),c.implies=r(R,"\\Rightarrow ","&rArr;"),c.rArr=c.Rightarrow=r(A,"\\Rightarrow ","&rArr;"),c.gets=r(R,"\\gets ","&larr;"),c.larr=c.leftarrow=r(A,"\\leftarrow ","&larr;"),c.impliedby=r(R,"\\Leftarrow ","&lArr;"),c.lArr=c.Leftarrow=r(A,"\\Leftarrow ","&lArr;"),c.harr=c.lrarr=c.leftrightarrow=r(A,"\\leftrightarrow ","&harr;"),c.iff=r(R,"\\Leftrightarrow ","&hArr;"),c.hArr=c.lrArr=c.Leftrightarrow=r(A,"\\Leftrightarrow ","&hArr;"),c.Re=c.Real=c.real=r(A,"\\Re ","&real;"),c.Im=c.imag=c.image=c.imagin=c.imaginary=c.Imaginary=r(A,"\\Im ","&image;"),c.part=c.partial=r(A,"\\partial ","&part;"),c.inf=c.infty=c.infin=c.infinity=r(A,"\\infty ","&infin;","inf"),c.pounds=r(A,"\\pounds ","&pound;"),c.alef=c.alefsym=c.aleph=c.alephsym=r(A,"\\aleph ","&alefsym;"),c.xist=c.xists=c.exist=c.exists=r(A,"\\exists ","&exist;"),c.nexists=c.nexist=r(A,"\\nexists ","&#8708;"),c.and=c.land=c.wedge=r(R,"\\wedge ","&and;"),c.or=c.lor=c.vee=r(R,"\\vee ","&or;"),c.o=c.O=c.empty=c.emptyset=c.oslash=c.Oslash=c.nothing=c.varnothing=r(R,"\\varnothing ","&empty;"),c.U=c.cup=c.union=r(R,"\\cup ","&cup;","U"),c.cap=c.intersect=c.intersection=r(R,"\\cap ","&cap;"),c.deg=c.degree=r(A,"\\degree ","&deg;"),c.ang=c.angle=r(A,"\\angle ","&ang;"),c.measuredangle=r(A,"\\measuredangle ","&#8737;");class Ct{static getInterface(){const t={},s=t=>{var s,n;if(!(t instanceof HTMLElement))return;const i=null!==(n=null===(s=t.querySelector(".mq-root-block"))||void 0===s?void 0:s.getAttribute(e))&&void 0!==n&&n,r=i?q.byId[parseInt(i)].controller:void 0;return null==r?void 0:r.apiClass};s.saneKeyboardEvents=f,s.config=t=>(v.config(v.prototype,t),s),s.registerEmbed=(t,e)=>{if(!/^[a-z][a-z0-9]*$/i.test(t))throw"Embed name must start with letter and be only letters and digits";u[t]=e};for(const[e,n]of Object.entries({StaticMath:lt,MathField:at,InnerMathField:ct,TextField:dt}))t[e]=n,(s[e]=(n,i)=>{const r=s(n);if(r instanceof t[e]||!(n instanceof HTMLElement))return r;const o=new nt(new t[e].RootBlock,n,new v);return o.KIND_OF_MQ=e,new t[e](o).config(i).__mathquillify()}).prototype=t[e].prototype;return s}static noConflict(){return window.MathQuill=this.origMathQuill,Ct}}Ct.origMathQuill=window.MathQuill;Ct.VERSION="0.10.1",window.MathQuill=Ct})();